angular.module("templates-main",["src/box/box.dir.tmpl.html","src/buttonSwitch/buttonSwitch.dir.tmpl.html","src/criticalApparatusEntry/criticalApparatusEntry.directive.tmpl.html","src/criticalApparatusEntry/criticalApparatusEntry.witnessRef.directive.tmpl.html","src/dialog/dialog.dir.tmpl.html","src/mobile/mobile.dir.tmpl.html","src/mobile/mobileInfo.dir.tmpl.html","src/mobile/mobileMenu.dir.tmpl.html","src/mobile/mobileSearch.dir.tmpl.html","src/mobile/mobileView.dir.tmpl.html","src/popover/popover.directive.tmpl.html","src/reading/reading.directive.tmpl.html","src/select/select.directive.tmpl.html","src/tabsContainer/tabsContainer.dir.tmpl.html"]),angular.module("src/box/box.dir.tmpl.html",[]).run(["$templateCache",function(a){a.put("src/box/box.dir.tmpl.html",'<section class="box box-{{vm.type}}" \n         id="{{vm.uid}}"\n         data-position="left"\n         data-getTotElementsOfType="{{vm.getTotElementsOfType(\'witness\')}}"\n         ng-class="{\'span9of9\' : vm.type === \'witness\' && vm.getTotElementsOfType(\'witness\') === 1,\n                    \'span6of12\': vm.type === \'witness\' && vm.getTotElementsOfType(\'witness\') === 2,\n                    \'span6of18\': (vm.type === \'witness\' && vm.getTotElementsOfType(\'witness\') === 3) || (vm.type === \'text\' && vm.getTotElementsOfType(\'witness\') > 1) || (vm.type === \'critical_apparatus\'),\n                    \'topBoxOpened\': vm.state.topBoxOpened,\n                    \'filterNotActive\': vm.state.filters._totActive <= 0}">\n    \n    <div \n        class="box-menu" \n        data-position="top"\n        ng-if="vm.type !== \'critical_apparatus\'">\n        <evt-select \n            data-id="{{selector.id}}"\n            data-type="{{selector.type}}"\n            data-init="{{selector.initValue}}"\n            ng-repeat="selector in vm.topMenuList.selectors">\n        </evt-select>\n        <button-switch \n            title="{{button.title}}"\n            data-label="{{button.label}}"\n            data-icon="{{button.icon}}"\n            data-type="{{button.type}}"\n            ng-repeat="button in vm.topMenuList.buttons">\n        </button-switch>\n    </div>\n    <div \n        class="box-top-box"\n        ng-class="{\'open\': vm.state.topBoxOpened}"\n        compile="vm.topBoxContent">\n    </div>\n    <div class="box-body" \n         style="{{vm.fontSize();}}"\n         ng-class="{ \'noBottomMenu\' : vm.bottomMenuList.buttons.length <= 0 && vm.bottomMenuList.selectors.length <= 0}"\n         id="box_body_{{vm.uid}}" \n         compile="vm.content" ng-transclude></div>\n    <!-- <div class="box-body" id="box_body_{{vm.uid}}">{{ vm.content }}</div> -->\n    <div class="loading" ng-if="vm.isLoading"><i class="fa fa-spinner fa-pulse loader"></i></div>\n    <div class="filters-in-box" \n         ng-if="(vm.type==\'witness\' || vm.type==\'text\') && vm.state.filters._totActive > 0">\n        <span \n            class="filter-group"\n            ng-repeat="filter in vm.state.filters"\n            ng-if="filter.totActive > 0">\n            <span \n                class="filter-value"\n                ng-repeat="value in filter.values"\n                ng-if="filter.values[value].active"\n                ng-click="vm.toggleCriticalAppFilter(filter.name, filter.values[value].name);"\n                style="background:{{filter.values[value].color}}"\n                title="Remove \'\'{{filter.values[value].name}}\'\'">\n                {{filter.values[value].name}}\n            </span>\n        </span>\n    </div>\n    <!-- <div class="box-bottom-box"> </div> -->\n    <div \n        class="filters-box"\n        ng-if="vm.type==\'witness\' || vm.type==\'text\'"\n        ng-class="{\'open\': vm.state.filterBox}">\n        \n        <div class="filter-group"\n             ng-repeat="filter in vm.appFilters"\n             ng-if="(vm.type==\'witness\' && filter.possibleFor.variant) || (vm.type==\'text\' && filter.possibleFor.lemma)">\n            <div class="filters-section-title">{{filter.name}}</div>\n            <div class="filter-value-outer">\n                <div \n                    class="filter-value">\n                    <span \n                        class="filter-value-label filter-any"\n                        title="Toggle \'\'any\'\'"\n                        ng-class="{\'active\': vm.state.filters[filter.name] === undefined || vm.state.filters[filter.name].totActive === 0}"\n                        ng-click="vm.clearFilter(filter.name);"> any </span>\n                </div>\n            </div>\n            <div class="filter-value-outer" ng-repeat="value in filter.values" >\n                <div \n                    style="background:{{value.color}}" \n                    class="filter-value">\n                    <span \n                        class="filter-value-label"\n                        title="Toggle \'\'{{value.name}}\'\'"\n                        ng-class="{\'active\': vm.state.filters[filter.name].values[value.name].active !== undefined && vm.state.filters[filter.name].values[value.name].active}"\n                        ng-click="vm.toggleCriticalAppFilter(filter.name, value.name);"> \n                        {{value.name}}</span>\n                </div>\n            </div>\n        </div>\n    </div>\n\n    <div \n        class="tools-group-box"\n        ng-if="vm.type==\'text\' || vm.type==\'witness\'"\n        ng-class="{\'open\': vm.getState(\'fontSizeBtn\')}">\n        <div \n            class="fontSizeBtnGroup">\n            <button-switch \n                class="no-background"\n                title="{{button.title}}"\n                data-label="{{button.label}}"\n                data-icon="{{button.icon}}"\n                data-type="{{button.type}}"\n                ng-repeat="button in vm.genericTools.fontSizeBtn">\n            </button-switch>\n        </div>\n    </div>\n\n    <div \n        class="box-menu" \n        data-position="bottom"\n        ng-if="vm.bottomMenuList.buttons.length > 0 || vm.bottomMenuList.selectors.length > 0">\n        <button-switch \n            title="{{button.title}}"\n            data-label="{{button.label}}"\n            data-icon="{{button.icon}}"\n            data-type="{{button.type}}"\n            ng-repeat="button in vm.bottomMenuList.buttons"\n            ng-show="button.show()">\n        </button-switch>\n    </div>\n</section>')}]),angular.module("src/buttonSwitch/buttonSwitch.dir.tmpl.html",[]).run(["$templateCache",function(a){a.put("src/buttonSwitch/buttonSwitch.dir.tmpl.html",'<span class="buttonSwitch" \n      title="{{vm.title}}"\n      ng-click="vm.doCallback()"\n      ng-class="{\'buttonSwitch-active\': vm.active, \'buttonSwitch-disabled\': vm.disabled,\n                 \'only-icon\': vm.label === undefined || vm.label === \'\'}">\n\n      <span \n        class="buttonSwitch-label"\n        ng-if="vm.label !== undefined && vm.label !== \'\'">{{vm.label}}</span>\n      <i class="icon {{vm.icon}} buttonSwitch-icon"></i>\n      \n</span>')}]),angular.module("src/criticalApparatusEntry/criticalApparatusEntry.directive.tmpl.html",[]).run(["$templateCache",function(a){a.put("src/criticalApparatusEntry/criticalApparatusEntry.directive.tmpl.html",'<div \n  class="critical-apparatus-entry"\n  ng-mouseover="vm.toggleOverAppEntries($event);"\n  ng-mouseout="vm.toggleOverAppEntries($event)"\n  ng-class="{\'noTools\': scopeViewMode !== \'collation\' && !vm.isPinAvailable()}">\n  <div class="critical-apparatus-entry_main-content">\n      <span \n        class="app_lemma"\n        ng-if="vm.content.lemma.content !== \'\'"\n        compile="vm.content.lemma.content"></span> \n      <span \n        class="app_reading"\n        ng-repeat="reading in vm.content.significantReadings" \n        compile="reading.content"></span> \n    \n    <div class="critical-apparatus-entry_tools"\n      ng-if="scopeViewMode === \'collation\' || vm.isPinAvailable()">\n      <button-switch \n            title="Remove Pin"\n            ng-if="vm.isPinAvailable() && vm.type === \'pinned\'"\n            data-label=""\n            data-icon="remove"\n            data-type="pinReading"\n            ng-click="vm.togglePin()"></button-switch>\n      <button-switch \n            title="Toggle Pin"\n            ng-if="vm.isPinAvailable() && vm.type === \'default\'"\n            data-label=""\n            data-icon="pin"\n            data-type="pinReading"\n            ng-class="{\'active\' : vm.isPinned()}"\n            ng-click="vm.togglePin()"></button-switch>\n      <button-switch \n            title="Align Readings"\n            ng-if="vm.type === \'default\' && scopeViewMode === \'collation\'"\n            data-label=""\n            data-icon="v-align"\n            data-type="alignReadings"\n            ng-click="vm.alignReadings()"></button-switch>\n    </div>\n  </div>\n  <div class="critical-apparatus-entry_other-content"\n       ng-if="vm.tabs._indexes.length > 0">\n\n      <div \n        class="critical-apparatus-entry_other-content_headers"\n        ng-class="{\'closed\': vm._subContentOpened === \'\'}">\n          <span ng-repeat="tab in vm.tabs._indexes"\n                ng-click="vm.toggleSubContent(tab)"\n                ng-class="{\'active\' : vm._subContentOpened == tab }">\n                {{ vm.tabs[tab].label }}\n          </span>\n      </div>\n      <div \n        class="critical-apparatus-entry_other-content_panels"\n        ng-class="{\'closed\': vm._subContentOpened === \'\'}">\n          <div class="critical-apparatus-entry_other-content_panel"\n                ng-repeat="tab in vm.tabs._indexes"\n                ng-class="{\'active\' : vm._subContentOpened == tab}"\n                ng-switch="tab">\n                <div ng-switch-when="notSignificantReadings">\n                  <ul>\n                      <li ng-repeat="reading in vm.content.notSignificantReadings" compile="reading.content"></li>\n                  </ul>\n                </div>\n                <div ng-switch-when="moreInfo">\n                  <span class="app_lemma">\n                    Metadata for lemma "<em \n                        ng-if="vm.content.lemma.content !== \'\'"\n                        compile="vm.content.lemma.content"></em>"\n                  </span>\n                  <ul ng-if="(vm.content.attributes._keys.length > 1 || vm.content.attributes._keys.length === 1 && vm.content.attributes._keys.indexOf(\'xml:id\') < 0)">\n                      <li ng-repeat="attr in vm.content.attributes._keys"\n                          ng-if="attr !== \'xml:id\'">\n                          <span class="moreInfo-label">{{attr}}</span> {{vm.content.attributes.values[attr]}}\n                      </li>\n                  </ul>\n                  <ul ng-if="(vm.content.attributes._keys.length <= 0 || vm.content.attributes._keys.length === 1 && vm.content.attributes._keys.indexOf(\'xml:id\') > 0)">\n                    <li><em>No data available</em></li></ul>\n                  \n                  <span class="moreInfo-metadataTitle">More info about the apparatus entry</span>\n                  <ul>\n                      <li \n                        class="app_lemma"\n                        class="app_reading_content"\n                        ng-if="(vm.content.lemma.attributes._keys.length > 1 || vm.content.lemma.attributes._keys.length === 1 && vm.content.lemma.attributes._keys.indexOf(\'xml:id\') < 0)">\n                          <span>\n                            Metadata for \n                            <em \n                                ng-if="vm.content.lemma.content !== \'\'"\n                                compile="vm.content.lemma.content"></em> \n                          </span>\n                          <ul>\n                            <li ng-repeat="attr in vm.content.lemma.attributes._keys"\n                                ng-if="attr !== \'xml:id\'">\n                                <span class="moreInfo-label">{{attr}}</span> {{vm.content.lemma.attributes.values[attr]}}\n                            </li>\n                          </ul>\n                      </li>\n\n                      <li \n                        class="app_reading_content"\n                        ng-repeat="reading in vm.content.significantReadings"\n                        ng-if="(reading.attributes._keys.length > 1 || reading.attributes._keys.length === 1 && reading.attributes._keys.indexOf(\'xml:id\') < 0)">\n                          <span>\n                            Metadata for \n                            <em \n                                class="app_reading"\n                                compile="reading.content"></em> \n                          </span>\n                          <ul>\n                            <li ng-repeat="attr in reading.attributes._keys"\n                                ng-if="attr !== \'xml:id\'">\n                                <span class="moreInfo-label">{{attr}}</span> {{reading.attributes.values[attr]}}\n                            </li>\n                          </ul>\n                      </li>\n\n                      <li \n                        class="app_reading_content"\n                        ng-repeat="reading in vm.content.notSignificantReadings"\n                        ng-if="(reading.attributes._keys.length > 1 || reading.attributes._keys.length === 1 && reading.attributes._keys.indexOf(\'xml:id\') < 0)">\n                          <span>\n                            Metadata for \n                            <em \n                                class="app_reading"\n                                compile="reading.content"></em> \n                          </span>\n                          <ul>\n                            <li ng-repeat="attr in reading.attributes._keys">\n                                <span class="moreInfo-label">{{attr}}</span> {{reading.attributes.values[attr]}}\n                            </li>\n                          </ul>\n                      </li>\n                  </ul>\n                </div>\n                <div ng-switch-when="xmlSource">\n                  <pre>{{ vm.content[tab] | prettyXml }}</pre>\n                </div>\n                <div ng-switch-default\n                     compile="vm.content[tab]">\n                </div>\n          </div>\n      </div>\n  </div>\n</div>')}]),angular.module("src/criticalApparatusEntry/criticalApparatusEntry.witnessRef.directive.tmpl.html",[]).run(["$templateCache",function(a){a.put("src/criticalApparatusEntry/criticalApparatusEntry.witnessRef.directive.tmpl.html",'<span class="wit" \n      ng-class="{\'selected\': witness === scopeWit}"\n      ng-click="openWit()"\n      title="{{title}}">{{witness}}</span>')}]),angular.module("src/dialog/dialog.dir.tmpl.html",[]).run(["$templateCache",function(a){a.put("src/dialog/dialog.dir.tmpl.html",'<div class="evt-dialog"\n    ng-show="vm.opened"\n    ng-class="{\'evt-dialog-error\': vm.type === \'error\',\n               \'evt-dialog-small\': vm.type === \'bookmark\' }">\n    <div class="evt-dialog-shadow" ng-click="vm.close()"></div>\n\n    <div class="evt-dialog-container">\n        <div class="evt-dialog-container-top">\n            <span class="evt-dialog-container-top-title">{{ vm.title }}</span>\n            <button-switch \n                    class="noPadding"\n                    title="Close"\n                    data-icon="remove"\n                    data-type="closeDialog">\n            </button-switch>\n        </div>\n        <div ng-switch="vm.type">\n            <div \n                ng-switch-when="error"\n                class="evt-dialog-container-content">{{vm.content}}</div>\n            <div \n                ng-switch-default\n                class="evt-dialog-container-content" ng-transclude></div>\n            \n        </div>\n    </div>\n</div>')}]),angular.module("src/mobile/mobile.dir.tmpl.html",[]).run(["$templateCache",function(a){a.put("src/mobile/mobile.dir.tmpl.html","<menu-mobile></menu-mobile>\n<info-mobile></info-mobile>\n<search-mobile></search-mobile>\n<view-mobile></view-mobile>\n\n")}]),angular.module("src/mobile/mobileInfo.dir.tmpl.html",[]).run(["$templateCache",function(a){a.put("src/mobile/mobileInfo.dir.tmpl.html",'<section \n    class="baseTemplate"\n    ng-if="view.currentView === \'info\'" >\n                        \n    <p class="dvbText">\n        When the transcription of the Vercelli Book manuscript (Codex CXVII, Archivio e Biblioteca Capitolare di Vercelli) passed the 50% landmark, \n        researchers working on the project started to think about the best way to visualize the edition.\n        Thanks to the openness and support of the Biblioteca Capitolare, it was decided to abandon the original plan of a CD/DVD publication,\n        largely inspired by digital editions such as the Electronic Beowulf, in favor of a web-based publication.\n        While this decision was critical in that it allowed us to select the most supported and widely-used medium, we soon discovered that it did not make choices any simpler. <br>\n        Since it was originally born as part of the Digital Vercelli Book project, EVT (Edition Visualization Technology) was developed to deal with the XML encoding of texts which had been prepared for that project, namely making use of the XML TEI P5\n        parallel transcription method. When using this method, information about the scan and possibly the coordinates\n        of sensible areas are separated from the transcription and aligned with it thanks to linking attributes.\n    </p>\n    <ul class="dvbList">\n        <li ng-repeat="item in dvb">\n            <a \n                href="{{item.url}}"\n                target="_blank"\n                title="{{item.title}}">\n\n                <span> \n\n                    {{item.description}}\n                    <i class="fa fa-external-link"></i>\n                    \n                </span>\n\n            </a>\n        </li>               \n    </ul>\n\n\n</section>')}]),angular.module("src/mobile/mobileMenu.dir.tmpl.html",[]).run(["$templateCache",function(a){a.put("src/mobile/mobileMenu.dir.tmpl.html",'<header role="banner" >\n    <nav \n        class="nav" \n        role="navigation">\n        <ul>\n            <li  \n                class="navItem"\n                ng-class="{\'active\': isActiveButton(item.template)}"\n                ng-click="showSection(item.template); buttonSection(item)" \n                ng-repeat="item in menu">\n                \n                <span>\n                    <i class="{{item.icon}}"></i>\n                </span>\n\n                <span class="title">\n                    <h1>{{item.description}}</h1>\n                </span>   \n                \n            </li>\n\n            <li \n                class="navItem" \n                ng-class="{\'active\': showItems}" \n                ng-click="toggleView()">\n                \n                <span>\n                    <i class="fa fa-eye"></i>\n                </span>\n                \n            </li>\n        </ul>\n        <ul \n            class="dropdown" \n            ng-show="showItems">\n    \n            <li \n                class="{{item.template}}"\n                ng-class="{\'active\': isActiveButton(item.template)}"\n                ng-click="showView(item.template); buttonView(item)"\n                ng-repeat="item in view">\n\n                <span>\n                    <i class="{{item.icon1}}"></i>\n                </span>\n\n                <span>\n                    <i class="{{item.icon2}}"></i>\n                </span>\n                \n            </li>\n        </ul>\n    </nav>\n</header>\n\n\n')}]),angular.module("src/mobile/mobileSearch.dir.tmpl.html",[]).run(["$templateCache",function(a){a.put("src/mobile/mobileSearch.dir.tmpl.html",'<section \n    class="baseTemplate"\n    ng-if="view.currentView === \'search\'" >\n\n    <div class="toolbarSearch">\n        <div class= "boxOptions">\n            <button\n                class="buttonOption"\n                ng-repeat="button in buttonsOption"\n                ng-class=\'{"activeOption": isActiveTab(button.tab)}\'\n                ng-click="showTabOptions(button)">\n\n                <span><h2><i class="{{button.icon}}"></i></h2></span>\n                <span><h2 ng-bind-html="button.description"></h2></span>\n\n            </button>\n        </div>\n        <div class="boxSearch">\n            <input \n                type="text"\n                ng-model="Search"\n                ng-click="removeText()">\n\n            <button \n                class="buttonSearch"\n                ng-click="showResults()">\n                <h2><i class="fa fa-search"></i></h2>\n            </button>\n        </div>\n       \n    </div>\n    \n    <div class="toolbarOptions" ng-switch on="currentOption">\n          \n        <div ng-switch-when="tabLetters">\n            <div class="listOptions">\n                <span \n                    class="letters"\n                    ng-repeat="letter in mockSearchLetters"\n                    ng-bind-html="letter">\n                </span>\n            </div>\n        </div>\n\n        <div ng-switch-when="tabFilters">\n            <div class="listOptions">\n                <span \n                    class="filters"\n                    ng-repeat="filter in mockSearchFilters">\n                    <input type="checkbox" id="{{filter.id}}">\n                    <label for="{{filter.id}}">{{filter.content}}</label>                    \n                </span>\n            </div>\n        </div>\n    </div>\n    \n    <div class="listResults" ng-hide="listResults">\n        <h3>Results for {{Search}}</h3>\n\n        <ul>\n            <li ng-repeat="text in mockText">\n                <div class="resultInfo">\n                    <span>{{text.title}}</span>\n                    <span>{{text.page}}</span>\n                </div>\n                <div class="resultText">\n                    <p>{{text.diplomatic}}</p>\n                </div>\n                \n            </li>\n        </ul>\n    </div> \n\n</section>')}]),angular.module("src/mobile/mobileView.dir.tmpl.html",[]).run(["$templateCache",function(a){a.put("src/mobile/mobileView.dir.tmpl.html",'<!--  View  -->\n\n<section \n    class="baseTemplate"\n    ng-if="view.currentView === \'image\'" >\n\n    <div class="fullscreen">\n\n        <figure\n            ng-repeat="img in mockImage"\n            ng-swipe-right="prevItem()"\n            ng-swipe-left="nextItem()"\n            ng-show="isActive($index)" >\n\n            <img\n                class="slide"\n                ng-src="{{img.url}}"\n                alt="{{img.title}} {{img.page}}" >\n\n        </figure>\n\n    </div>\n\n    <!-- prev / next controls -->\n\n    <span \n        class="prev"\n        ng-click="prevItem()">\n    </span>\n\n    <span \n        class="next"\n        ng-click="nextItem()">\n    </span>\n\n</section>\n\n\n<section \n    class="baseTemplate"\n    ng-if="view.currentView === \'text\'" >\n\n    <div class="fullscreen">\n\n        <div\n            class="boxText"\n            ng-repeat="text in mockText">\n\n           \n            <div\n                class="information"\n                ng-show="isActive($index)">\n\n                <span class="textPage">{{text.page}}</span>\n                <span class="textTitle">{{text.title}}</span>\n                              \n            </div>\n\n            <div\n                class="contentText"\n                ng-swipe-right="singlePrev()"\n                ng-swipe-left="singleNext()"\n                ng-show="isActive($index)"\n                ng-if="editionDipl.currentEditionDipl === \'diplomatic\'">\n\n                <p ng-include="text.diplomatic"></p>\n\n            </div>\n\n            <div\n                class="contentText"\n                ng-swipe-right="singlePrev()"\n                ng-swipe-left="singleNext()"\n                ng-show="isActive($index)"\n                ng-if="editionDipl.currentEditionDipl === \'interpretative\'">\n\n                <p ng-include="text.interpretative"></p>\n\n            </div>        \n\n        </div>\n\n    </div>   \n    \n    <!-- prev / next controls -->\n\n    <span \n        class="prev"\n        ng-click="prevItem()">\n    </span>\n\n    <span \n        class="next"\n        ng-click="nextItem()">\n    </span>\n\n</section>\n\n\n<section \n    class="baseTemplate"\n    ng-if="view.currentView === \'imageimage\'" >\n\n    <div class="fullscreen">\n\n        <figure\n            ng-repeat="img in mockBook"\n            ng-swipe-right="prevImageImage()"\n            ng-swipe-left="nextImageImage()"\n            ng-show="isActive($index)">\n\n            <img \n                class="slide"\n                ng-src="{{img.url}}"\n                alt="{{img.title}} {{img.page}}">\n\n        </figure>\n\n    </div>\n\n    <!-- prev / next controls -->\n\n    <span \n        class="prev"\n        ng-click="prevImageImage()">\n    </span>\n\n    <span \n        class="next"\n        ng-click="nextImageImage()">\n    </span>\n\n</section>\n\n\n<section \n    class="baseTemplate"\n    ng-if="view.currentView === \'imagetext\'" >\n\n    <div class="halfscreen">\n\n        <figure\n            ng-repeat="img in mockImage"\n            ng-swipe-right="prevItem()"\n            ng-swipe-left="nextItem()"\n            ng-show="isActive($index)">\n\n            <img\n                class="slide"\n                ng-src="{{img.url}}"\n                alt="{{img.title}} {{img.page}}" >\n\n        </figure>\n\n    </div>\n    <div class="halfscreen">\n\n        <div\n            class="boxText"\n            ng-repeat="text in mockText">\n\n            <div\n                class="information"\n                ng-show="isActive($index)">\n\n                <span class="textPage">{{text.page}}</span>\n                <span class="textTitle">{{text.title}}</span>\n                              \n            </div>\n\n            <div\n                class="contentText"\n                ng-swipe-right="singlePrev()"\n                ng-swipe-left="singleNext()"\n                ng-show="isActive($index)"\n                ng-if="editionInt.currentEditionInt === \'diplomatic\'">\n\n                <p ng-include="text.diplomatic"></p>\n\n            </div>\n\n            <div\n                class="contentText"\n                ng-swipe-right="singlePrev()"\n                ng-swipe-left="singleNext()"\n                ng-show="isActive($index)"\n                ng-if="editionInt.currentEditionInt === \'interpretative\'">\n\n                <p ng-include="text.interpretative"></p>\n\n            </div> \n\n\n        </div>\n\n    </div>\n    \n    <!-- prev / next controls -->\n\n    <span \n        class="prev"\n        ng-click="prevItem()">\n    </span>\n\n    <span \n        class="next"\n        ng-click="nextItem()">\n    </span>\n\n</section>\n\n\n<section \n    class="baseTemplate"\n    ng-if="view.currentView === \'texttext\'" >\n\n    <div class="halfscreen">\n\n        <div\n            class="boxText"\n            ng-repeat="text in mockText">\n\n            <div\n                class="information"\n                ng-show="isActive($index)">\n\n                <span class="textPage">{{text.page}}</span>\n                <span class="textTitle">{{text.title}}</span>\n                              \n            </div>\n\n            <div\n                class="contentText"\n                ng-swipe-right="singlePrev()"\n                ng-swipe-left="singleNext()"\n                ng-show="isActive($index)"\n                ng-if="editionDipl.currentEditionDipl === \'diplomatic\'">\n\n                <p ng-include="text.diplomatic"></p>\n\n            </div>\n\n            <div\n                class="contentText"\n                ng-swipe-right="singlePrev()"\n                ng-swipe-left="singleNext()"\n                ng-show="isActive($index)"\n                ng-if="editionDipl.currentEditionDipl === \'interpretative\'">\n\n                <p ng-include="text.interpretative"></p>\n\n            </div> \n\n        </div>\n\n    </div>\n    \n    <div class="halfscreen">\n\n        <div\n            class="boxText"\n            ng-repeat="text in mockText">\n\n            <div\n                class="information"\n                ng-show="isActive($index)">\n\n                <span class="textPage">{{text.page}}</span>\n                <span class="textTitle">{{text.title}}</span>\n                              \n            </div>\n\n            <div\n                class="contentText"\n                ng-swipe-right="singlePrev()"\n                ng-swipe-left="singleNext()"\n                ng-show="isActive($index)"\n                ng-if="editionInt.currentEditionInt === \'diplomatic\'">\n\n                <p ng-include="text.diplomatic"></p>\n\n            </div>\n\n            <div\n                class="contentText"\n                ng-swipe-right="singlePrev()"\n                ng-swipe-left="singleNext()"\n                ng-show="isActive($index)"\n                ng-if="editionInt.currentEditionInt === \'interpretative\'">\n\n                <p ng-include="text.interpretative"></p>\n\n            </div> \n\n        </div>\n\n    </div>\n    \n    <!-- prev / next controls -->\n\n    <span \n        class="prev"\n        ng-click="prevItem()">\n    </span>\n\n    <span \n        class="next"\n        ng-click="nextItem()">\n    </span>\n\n</section>\n\n<!--  end View  -->\n\n<!--  Toolbar  -->\n\n<section class="toolbar">\n\n    <section class="settings">\n        <section \n            class="leftSettings"\n            ng-if="view.currentView === \'text\' || view.currentView === \'texttext\'">\n\n            <div class="contentSettings">\n                <div \n                    class ="leftSetOptions"\n                    ng-show="leftTextOptions">\n                    \n                    <ul class="optionText">\n                        <li \n                            class="{{option.template}}"\n                            ng-class="{\'active\': isActiveButtonDipl(option.template)}"\n                            ng-repeat="option in textEdition"\n                            ng-click="showEditionDipl(option.template); buttonEditionDipl(option)">\n\n                            <span> {{option.description}}</span>\n                        </li>\n                        \n                    </ul>\n\n                </div>\n                <div\n                    class="leftButtonSettings"\n                    ng-class="{\'active\': leftTextOptions}"\n                    ng-click="leftTextSettings()">\n\n                    <span>\n                        <i class="fa fa-cogs"></i>\n                    </span>\n\n                </div>\n                \n            </div>\n\n        </section>\n\n        <section \n            class="rightSettings"\n            ng-if="view.currentView === \'imagetext\' || view.currentView === \'texttext\'">\n\n            <div class="contentSettings">\n                <div \n                    class ="rightSetOptions"\n                    ng-show="rightTextOptions">\n                    \n                    <li \n                        class="{{option.template}}"\n                        ng-class="{\'active\': isActiveButtonInt(option.template)}"\n                        ng-repeat="option in textEdition"\n                        ng-click="showEditionInt(option.template); buttonEditionInt(option)">\n\n                        <span> {{option.description}}</span>\n                    </li>\n\n                </div>\n                <div\n                    class="rightButtonSettings"\n                    ng-class="{\'active\': rightTextOptions}"\n                    ng-click="rightTextSettings()">\n\n                    <span>\n                        <i class="fa fa-cogs"></i>\n                    </span>\n\n                </div>\n                \n            </div>\n\n        </section>\n\n    </section>\n\n\n    <section\n        class="thumbImage"\n        ng-if="view.currentView === \'image\'">\n\n        <div\n            class="buttonThumb"\n            ng-class="{\'active\': navThumb}"\n            ng-click="showThumb()">\n\n            <span>\n                <i class="fa fa-ellipsis-h"></i>\n            </span>\n\n        </div>\n        <div \n            class="navThumb"\n            ng-show="navThumb">\n\n           <figure \n                ng-class="{\'active\': isActive($index)}"\n                ng-click="showImage($index)"\n                ng-repeat="img in thumbnails">\n                \n                <img \n                    ng-src="{{img.url}}"\n                    alt="{{img.page}}">\n\n                <figcaption>{{img.page}}</figcaption>\n\n            </figure> \n          \n        </div>\n\n    </section>\n\n    <section\n        class="thumbImage"\n        ng-if="view.currentView === \'imageimage\'">\n\n        <div\n            class="buttonThumb"\n            ng-class="{\'active\': navThumb}"\n            ng-click="showThumb()">\n\n            <span>\n                <i class="fa fa-ellipsis-h"></i>\n            </span>\n\n        </div>\n        <div \n            class="navThumb"\n            ng-show="navThumb">\n\n           <figure \n                ng-class="{\'active\': isActive($index)}"\n                ng-click="showImage($index)"\n                ng-repeat="img in thumbBook">\n                \n                <img \n                    ng-src="{{img.url}}"\n                    alt="{{img.page}}">\n\n                <figcaption>{{img.page}}</figcaption>\n\n            </figure> \n          \n        </div>\n\n    </section>\n\n    <section\n        class="thumbText"\n        ng-if="view.currentView === \'text\' || view.currentView === \'imagetext\' || view.currentView === \'texttext\'">\n\n        <div\n            class="buttonThumb"\n            ng-class="{\'active\': navThumb}"\n            ng-click="showThumb()">\n\n            <span>\n                <i class="fa fa-ellipsis-h"></i>\n            </span>\n\n        </div>\n        <div \n            class="navThumb"\n            ng-show="navThumb">\n\n           <figure \n                ng-class="{\'active\': isActive($index)}"\n                ng-click="showImage($index)"\n                ng-repeat="img in thumbnails">\n                \n                <img \n                    ng-src="{{img.url}}"\n                    alt="{{img.page}}">\n\n                <figcaption>{{img.page}}</figcaption>\n\n            </figure> \n          \n        </div>\n\n    </section>\n\n</section>\n\n<!--  end Toolbar -->')
}]),angular.module("src/popover/popover.directive.tmpl.html",[]).run(["$templateCache",function(a){a.put("src/popover/popover.directive.tmpl.html",'<span class="popover">\n   <span \n        class="popover_trigger" \n        ng-mouseover="vm.toggleMouseHover($event, vm)" \n        ng-mouseout="vm.toggleMouseHover($event, vm)"\n        ng-click="vm.triggerClick($event, vm);" \n        ng-class="{\'expanded\':vm.expanded, \n                   \'active\': vm.over,\n                   \'blurred\': $parent.vm.state.topBoxOpened}">\n        <span ng-transclude></span>\n   </span>\n   <span \n        class="popover_tooltip" \n        ng-class="{\'expanded\':vm.expanded || (vm.trigger===\'over\' && vm.over)}"\n        ng-mouseover="vm.toggleTooltipHover($event, vm)"\n        ng-mouseout="vm.toggleTooltipHover($event, vm)">\n        <span \n            class="popover__tooltip__before" \n            ng-mouseover="vm.toggleTooltipHover($event, vm)"\n            ng-mouseout="vm.toggleTooltipHover($event, vm)"></span>\n      <span compile="vm.tooltip"></span>\n   </span>\n</span>')}]),angular.module("src/reading/reading.directive.tmpl.html",[]).run(["$templateCache",function(a){a.put("src/reading/reading.directive.tmpl.html",'<span \n    class="reading"\n    ng-mouseover="vm.toggleOverAppEntries($event);"\n    ng-mouseout="vm.toggleOverAppEntries($event)"\n    ng-class="{ \'selected\' : vm.isSelect() && !$parent.vm.state.topBoxOpened,\n                \'expansed\' : (!$parent.vm.state.topBoxOpened && vm.apparatus.opened),\n                \'over\'     : vm.over, \n                \'invisible\': !vm.fitFilters(),\n                \'blurred\'  : $parent.vm.state.topBoxOpened}">\n    <span \n        class="reading__text"\n        style="{{vm.backgroundColor()}}"\n        title="{{vm.attributes}}"\n        ng-click="vm.callbackClick($event);"\n        ng-transclude></span>\n\n    <evt-critical-apparatus-entry \n      ng-class="{\'blurred\': $parent.vm.state.topBoxOpened}"\n      ng-if="vm.apparatus._loaded"\n      ng-show="vm.isApparatusOpened() && vm.fitFilters()"\n      data-app-id="{{vm.appId}}"\n      data-reading-id="{{vm.readingId}}"\n      data-scope-wit="{{vm.scopeWit}}"></evt-critical-apparatus-entry>\n</span>')}]),angular.module("src/select/select.directive.tmpl.html",[]).run(["$templateCache",function(a){a.put("src/select/select.directive.tmpl.html",'<div class="selector" \n     data-parent="{{vm.parent}}"\n     ng-show="vm.optionList.length > 0">\n   <span \n      class="label_selected" \n      title="{{vm.getOptionSelected().title}}"\n      data-value="{{vm.getOptionSelected().value}}">\n      {{vm.getOptionSelected().label}}\n   </span>\n   <div \n      class="open_options" \n      ng-click="vm.toggleExpand()">\n      <i class="fa fa-sort-desc"></i>\n   </div>\n   <div \n      class="option_container"\n      ng-class="{\'expanded\':vm.expanded}" >\n      <div \n         class="option" \n         title="{{option.title}}" \n         data-value="{{option.value}}"\n         data-wit="{{option.ed}}"\n         ng-repeat="option in vm.optionList" \n         ng-click="vm.callback(vm.optionSelected, option);"\n         ng-class="{\'selected\': vm.isOptionSelected(option)}">\n         {{option.label}}\n      </div>\n   </div>\n</div>')}]),angular.module("src/tabsContainer/tabsContainer.dir.tmpl.html",[]).run(["$templateCache",function(a){a.put("src/tabsContainer/tabsContainer.dir.tmpl.html",'<div class="evt-tabs-container {{ orientation }}">\n    <div \n        class="evt-tabs-container_headers"\n        ng-class="{\'closed\': subContentOpened === \'\'}">\n        \n        <span \n            class="evt-tabs-container_header"\n            ng-repeat="tab in tabs._indexes"\n            ng-click="toggleSubContent(tab)"\n            ng-class="{\'active\' : subContentOpened == tab }">\n            {{ tabs[tab].label }}\n        </span>\n    </div>\n    <div \n        class="evt-tabs-container_panels"\n        ng-class="{\'closed\': subContentOpened === \'\'}">\n        \n        <div class="evt-tabs-container_panel"\n            ng-repeat="tab in tabs._indexes"\n            ng-class="{\'active\' : subContentOpened == tab}"\n            compile="tabs[tab].content">\n        </div>\n    </div>\n</div>')}]),angular.module("evtviewer",["ngAnimate","ngCookies","ngMessages","ngResource","ngRoute","ngSanitize","ngTouch","templates-main","xml","prettyXml","evtviewer.core","evtviewer.communication","evtviewer.dataHandler","evtviewer.interface","evtviewer.box","evtviewer.select","evtviewer.buttonSwitch","evtviewer.popover","evtviewer.mobile","evtviewer.criticalApparatusEntry","evtviewer.reading","evtviewer.dialog","evtviewer.tabsContainer"]),angular.module("evtviewer.core",[]),angular.module("evtviewer.core").constant("GLOBALDEFAULTCONF",{test:{active:!1},debugAllModules:!0,debugConf:{log:!0,info:!0,warn:!0,debug:!0},modules:{"interface":{active:!0}},configUrl:"config/config.json",dataUrl:"data/pseudo-edition-test-file_mod.xml",preferredWitness:"A",skipWitnesses:"",indexTitle:"EVT Critical Viewer TEST",webSite:"",defaultViewMode:"critical",defaultEdition:"critical",availableViewModes:[{label:"Critical",icon:"mode-critical",viewMode:"critical",visible:!0},{label:"Image Text",icon:"mode-imgTxt",viewMode:"imgTxt",visible:!0},{label:"Text Text",icon:"mode-txtTxt",viewMode:"txtTxt",visible:!1},{label:"Collation",icon:"mode-collation",viewMode:"collation",visible:!0}],toolHeatMap:!0,toolPinAppEntries:!1,listDef:"listWit, listChange",versionDef:"witness, change",fragmentMilestone:"<witStart>, <witEnd>",lacunaMilestone:"<lacunaStart>, <lacunaEnd>",skipCriticalEntriesFilters:"wit, target, corresp",possibleVariantFilters:"type, cause, hand",possibleLemmaFilters:"resp, cert",notSignificantVariant:"<orig>, <sic>, [type=orthographic]",loadCriticalEntriesImmediately:!0,maxWitsLoadTogether:5,variantColors:{},filterColors:{},genericColors:["rgb(52, 197, 173)","rgb(238, 194, 66)","rgb(253, 153, 54)","rgb(253, 95, 58)","rgb(235, 77, 153)","rgb(252, 144, 172)","rgb(171, 99, 219)","rgb(67, 135, 217)","rgb(163, 207, 81)","rgb(238, 194, 66)","rgb(228, 99, 220)","rgb(124, 113, 232)"],variantColorLight:"rgb(208, 220, 255)",variantColorDark:"rgb(101, 138, 255)",heatmapColor:"rgb(255, 108, 63)",xsltUrl:""}),angular.module("evtviewer.core").provider("Utils",function(){this.deepExtend=function(a,b){for(var c in b)b[c]&&b[c].constructor&&b[c].constructor===Object?(a[c]=a[c]||{},arguments.callee(a[c],b[c])):a[c]=angular.copy(b[c]);return a},this.deepExtendSkipDefault=function(a,b){for(var c in b)b[c]&&b[c].constructor&&b[c].constructor===Object?(a[c]=a[c]||{},arguments.callee(a[c],b[c])):"dataUrl"===c?""!==b[c]&&(a[c]=angular.copy(b[c])):"NONE"===b[c]||"NULL"===b[c]?a[c]="":""!==b[c]&&(a[c]=angular.copy(b[c]));return a},this.$get=function(){return{deepExtend:this.deepExtend}}}),angular.module("evtviewer.core").constant("BASECONFIG",{debug:!1}).provider("config",["UtilsProvider","GLOBALDEFAULTCONF","BASECONFIG",function(a,b,c){var d={};a.deepExtend(d,b),"undefined"!=typeof window.globalConfig&&angular.isObject(window.globalConfig)&&a.deepExtend(d,window.globalConfig),"undefined"==typeof window.GLOBALCONFIG&&(window.GLOBALCONFIG=d),this.makeDefaults=function(b,e){var f=angular.copy(c);return"undefined"!=typeof e&&a.deepExtend(f,e),"undefined"!=typeof d.modules[b]&&a.deepExtend(f,d.modules[b]),d.modules[b]=f,f},this.isValid=function(){return!0},this.isModuleActive=function(a){return angular.isObject(d.modules[a])&&d.modules[a].active===!0},this.extendDefault=function(b){a.deepExtendSkipDefault(d,b)},this.$get=function(){return d.isValid=this.isValid,d.isModuleActive=this.isModuleActive,d.extendDefault=this.extendDefault,d}}]),angular.module("evtviewer.core").run(["$log","config",function(a,b){function c(c,d,e){return function(){var f,g=a.enabledContexts[e],h=b.modules[e];if(b.debugConf[d]!==!1&&(f="undefined"!=typeof g?g:"undefined"!=typeof h&&"undefined"!=typeof h.debug?h.debug:!1,b.debugAllModules===!0||f===!0)){var i=Array.prototype.slice.call(arguments);i.unshift("#"+e+"#"),c.apply(null,i)}}}function d(a,b){return function(){var c=function(){try{throw Error("")}catch(a){return a}},d=c(),e=d.stack.split("\n")[4],f=Array.prototype.slice.call(arguments);f.unshift("#EVTViewer "+b+"#"),f.push(e),a.apply(null,f)}}a.enabledContexts=[],a.getInstance=function(b){return{log:c(a.log,"log",b),info:c(a.info,"info",b),warn:c(a.warn,"warn",b),debug:c(a.debug,"debug",b),error:d(a.error,b),enableLogging:function(c){a.enabledContexts[b]=c}}}}]),angular.module("evtviewer.core").service("eventDispatcher",["$q",function(a){var b={},c={};return b.sendEvent=function(b,d){var e,f=[],g=[],h=0;return c[b]&&angular.forEach(c[b],function(b){"undefined"!=typeof b&&(e={args:d,resolve:function(a){h<g.length&&(g[h].resolve(a),h++)},reject:function(a){h<g.length&&(g[h].reject(a),h++)}},g.push(a.defer()),b.apply(null,[e]))}),f=g.map(function(a){return a.promise}),a.all(f)},b.addListener=function(a,b){return c[a]||(c[a]=[]),c[a].push(b),[a,b]},b.addListeners=function(a,c){var d=[];for(var e in a)d.push(b.addListener(a[e],c));return d},b.removeListener=function(a){var b=a[0],d=a[1];c[b]&&angular.forEach(c[b],function(a,e){a===d&&(c[b].splice(e,1),0===c[b].length&&delete c[b])})},b.getListeners=function(){var a=[];for(var b in c)a.push(b);return a},b}]),angular.module("evtviewer.core").config(["$compileProvider",function(a){a.directive("compile",["$compile",function(a){return function(b,c,d){b.$watch(function(a){return a.$eval(d.compile)},function(d){c.html(d),a(c.contents())(b)})}}])}]),angular.module("evtviewer.dataHandler",[]),angular.module("evtviewer.dataHandler").service("baseData",["$log","xmlParser","evtParser","evtCriticalParser","evtProjectInfoParser",function(a,b,c,d,e){var f={},g={XMLDocuments:[],XMLStrings:[]},h=a.getInstance("baseData"),i=function(a){var f=b.parse(a);if("TEI"===f.documentElement.nodeName){g.XMLStrings.push(a),g.XMLDocuments.push(f);{c.parseDocuments(f)}d.parseWitnesses(f),e.parseProjectInfo(f),h.log("XML TEI parsed and stored ",g.XMLDocuments)}else h.error("Something wrong with the XML")};return f.addXMLString=function(a){i(a)},f.getXMLDocuments=function(){return g.XMLDocuments},f.getXMLStrings=function(){return g.XMLStrings},f}]),angular.module("evtviewer.dataHandler").service("parsedData",["$log","config",function(a,b){var c={},d=a.getInstance("dataHandler");d.log("parsedData running");var e={fileDescription:"",encodingDescription:"",textProfile:"",outsideMetadata:"",revisionHistory:""},f={length:0},g={length:0},h={_indexes:{witnesses:[],groups:[],encodingStructure:[]}},i=b.genericColors,j={filtersCollection:{filters:{},length:0,forLemmas:0,forVariants:0,colors:[]},__allLoaded:!1,_maxVariance:0,_indexes:{encodingStructure:[],appEntries:[]}},k={},l=[{value:"critical",label:"Critical",title:"Critical edition"},{value:"interpretative",label:"Interpretative",title:"Interpretative edition"},{value:"diplomatic",label:"Diplomatic",title:"Diplomatic edition"}];return c.addPage=function(a){var b=a.value;void 0===f.length&&(f.length=0),""===a.value&&(b=a.value="page_"+(f.length+1)),void 0===f[b]&&(f[f.length]=b,f[b]=a,f.length++)},c.getPages=function(){return f},c.getPage=function(a){return f[a]},c.getPageText=function(a){for(var b=[],c=0;c<b.length&&b[c].page!==a;)c++;return{}},c.getPageImage=function(a){for(var b=[],c=0;c<b.length&&b[c].page!==a;)c++;return{}},c.addDocument=function(a){var b=a.value;void 0===g.length&&(g.length=0),""===a.value&&(b=a.value="doc_"+(g.length+1)),void 0===g[b]&&(g[g.length]=b,g[b]=a,g.length++)},c.getDocuments=function(){return g},c.getDocument=function(a){return g[a]},c.addEditions=function(){},c.getEditions=function(){return l},c.getEdition=function(a){for(var b,c=0;c<l.length&&void 0===b;)l[c].value===a&&(b=l[c]),c++;return b},c.addElementInWitnessCollection=function(a){var c=b.skipWitnesses.split(",").filter(function(a){return 0!==a.length});c.indexOf(a.id)<0&&void 0===h[a.id]&&(h[a.id]=a,"group"===a._type?h._indexes.groups.push(a.id):h._indexes.witnesses.push(a.id),void 0===a._group&&h._indexes.encodingStructure.push(a.id))},c.addWitnessText=function(a,b,c){void 0!==h[a]&&(void 0===h[a].text&&(h[a].text={}),h[a].text[b]=c)},c.getWitnessText=function(a,b){return void 0!==h[a]&&void 0!==h[a].text&&void 0!==h[a].text[b]?h[a].text[b]:void 0},c.getWitnessesList=function(){return h._indexes.witnesses},c.getWitnesses=function(){return h},c.getWitness=function(a){return h[a]},c.getWitnessPages=function(a){if(void 0!==h[a]){if(void 0===h[a].pages){for(var b={length:0},c=0;c<f.length;c++){var d=f[f[c]];d.ed==="#"+a&&(b[b.length]=f[c],b[f[c]]=d,b.length++)}h[a].pages=b}return h[a].pages}},c.isWitnessesGroup=function(a){return void 0!==h[a]&&"group"===h[a]._type},c.getWitnessesInGroup=function(a){var b=[];if(void 0!==h[a]&&"group"===h[a]._type){var d=h[a].content;for(var e in d){var f=d[e];c.isWitnessesGroup(f)?b.push.apply(b,c.getWitnessesInGroup(f)):b.push(f)}}return b},c.getWitnessesListFormatted=function(){var a,b=h._indexes.encodingStructure;a="<ul>";for(var c=0;c<b.length;c++){var d=h[b[c]];if("witness"===d._type)a+="<li>",a+="<strong>#"+d.id+"</strong><br /><div>"+d.description.innerHTML+"</div>",a+="</li>";else{a+="<li>",a+="<strong>#"+d.id+"</strong><br /><div>"+d.name+"</div>",a+="<ul>";for(var e=0;e<d.content.length;e++){var f=h[d.content[e]];"witness"===f._type&&(a+="<li>",a+="<strong>#"+f.id+"</strong><br /><div>"+f.description.innerHTML+"</div>",a+="</li>")}a+="</ul>",a+="</li>"}}return a+="</ul>"},c.getCriticalTextsCollection=function(){return k},c.addCriticalText=function(a,b){k[b]=a},c.getCriticalText=function(a){return k[a]},c.addCriticalEntry=function(a){void 0===j[a.id]&&(j[a.id]=a,j._indexes.appEntries.push(a.id),a._subApp||j._indexes.encodingStructure.push(a.id)),a._variance>j._maxVariance&&(j._maxVariance=a._variance)},c.setCriticalEntriesLoaded=function(a){j.__allLoaded=a},c.getCriticalEntries=function(){return j},c.getCriticalEntryById=function(a){return j[a]},c.getCriticalEntriesMaxVariance=function(){return j._maxVariance},c.getReadingAttributes=function(a,b){var c=[];return void 0!==j[b].content[a]&&(c=j[b].content[a].attributes),c},c.getGenericColorForAppEntry=function(a){var b,d=j.filtersCollection;return void 0===d.colors||d.colors.indexOf(i[a])<0?(b=i[a],i.splice(a,1)):b=c.getGenericColorForAppEntry(a+1),b},c.addCriticalEntryFilter=function(a,d){var e=b.possibleVariantFilters,f=b.possibleLemmaFilters,g=j.filtersCollection;if((e.indexOf(a)>=0||f.indexOf(a)>=0)&&(void 0===g.filters[a]&&(g.filters[a]={name:a,possibleFor:{lemma:f.indexOf(a)>=0,variant:e.indexOf(a)>=0},values:{}}),void 0===g.filters[a].values[d])){var h;void 0!==b.variantColors[a]&&void 0!==b.variantColors[a][d]&&""!==b.variantColors[a][d]?(h=b.variantColors[a][d],i.indexOf(h)>=0&&i.splice(i.indexOf(h),1)):h=c.getGenericColorForAppEntry(0),g.colors.push(h);var k={name:d,color:h};g.filters[a].values[d]=k,g.length++,e.indexOf(a)>=0&&g.forVariants++,f.indexOf(a)>=0&&g.forLemmas++}},c.getCriticalEntriesFiltersCollection=function(){return j.filtersCollection},c.getCriticalEntriesFilters=function(){return j.filtersCollection.filters},c.getCriticalEntriesFilterValues=function(a){return j.filtersCollection.filters[a]},c.getCriticalEntriesFilterColor=function(a,b){return j.filtersCollection.filters[a].values[b].color},c.updateProjectInfoContent=function(a,b){e[b]=a},c.getProjectInfo=function(){return e},c}]),angular.module("evtviewer.dataHandler").service("evtParser",["parsedData",function(a){var b={},c=0,d="pb";return b.isNestedInElem=function(a,c){return null!==a.parentNode?"text"===a.parentNode.tagName?!1:a.parentNode.tagName===c?!0:b.isNestedInElem(a.parentNode,c):!1},b.parseXMLElement=function(a,c,d){var e;if(3===c.nodeType)e=c;else if(void 0!==c.tagName&&d.indexOf("<"+c.tagName.toLowerCase()+">")>=0)e=c;else{var f=void 0!==c.tagName?c.tagName.toLowerCase():"";if(void 0!==c.attributes&&void 0!==c.attributes.copyOf&&""!==c.attributes.copyOf.value){e=document.createElement("span"),e.className=f+" copy";var g=c.attributes.copyOf.value.replace("#",""),h="<"+c.tagName+' xml:id="'+g+".*</"+c.tagName+">",i=new RegExp(h,"ig"),j=a.outerHTML.match(i);if(j){var k=angular.element(j[0])[0];e.appendChild(b.parseXMLElement(a,k,d))}}else if("l"===f)e=b.parseLine(c);else if("note"===f&&"evtNote"!==d)e=b.parseNote(c);else{if(e=document.createElement("span"),e.className=f,c.attributes)for(var l=0;l<c.attributes.length;l++){var m=c.attributes[l];m.specified&&"xml:id"!==m.name&&e.setAttribute("data-"+m.name.replace(":","-"),m.value)}if(c.childNodes)for(var n=0;n<c.childNodes.length;n++){var o=c.childNodes[n].cloneNode(!0);e.appendChild(b.parseXMLElement(a,o,d))}else e.innerHTML=c.innerHTML}}return e},b.balanceXHTML=function(a){a.lastIndexOf("<")>a.lastIndexOf(">")&&(a=a.substring(0,a.lastIndexOf("<")));var b=a.match(/<[^>]+>/g),c=[];for(var d in b)b[d].search("/")<=0?c.push(b[d]):1===b[d].search("/")&&c.pop();for(;c.length>0;){var e=c.pop();e=e.substring(1,e.search(/[ >]/)),a+="</"+e+">"}return a},b.parseNote=function(a){var b=document.createElement("evt-popover");return b.setAttribute("data-trigger","click"),b.setAttribute("data-tooltip",a.innerHTML),b.innerHTML='<i class="icon-evt_note"></i>',b},b.parseLines=function(a){for(var b=a.getElementsByTagName("l"),c=0;c<b.length;){var d=b[c],e=document.createElement("div");e.className="l",e.className=d.tagName;for(var f=0;f<d.attributes.length;f++){var g=d.attributes[f];g.specified&&e.setAttribute("data-"+g.name,g.value)}e.innerHTML=d.innerHTML,d.parentNode.replaceChild(e,d)}},b.parseLine=function(a){var b=document.createElement("div");b.className="l",b.className=a.tagName;for(var c=0;c<a.attributes.length;c++){var d=a.attributes[c];d.specified&&b.setAttribute("data-"+d.name,d.value)}return b.innerHTML=a.innerHTML,b},b.xpath=function(a){try{if("string"==typeof a)return document.evaluate(a,document,null,0,null);if(!a||1!==a.nodeType)return"";var d=[];a.parentNode&&(d=[].filter.call(a.parentNode.children,function(b){return b.tagName===a.tagName}));var e=d.length>1?[].indexOf.call(d,a)+1:"";e=e>1?e-1:"";var f="tei"!==a.tagName.toLowerCase()?"-"+a.tagName.toLowerCase():"";return b.xpath(a.parentNode)+f+e}catch(g){return c++,"-id"+c}},b.parsePages=function(b,c){var e=angular.element(b);angular.forEach(e.find(d),function(b){var d={};d.value=b.getAttribute("ed")?b.getAttribute("xml:id")||b.getAttribute("ed").replace("#","")+"-"+b.getAttribute("n")||"page_"+(a.getPages().length+1):b.getAttribute("xml:id")||"page_"+(a.getPages().length+1),d.label=b.getAttribute("n")||"Page "+(a.getPages().length+1),d.title=b.getAttribute("n")||"Page "+(a.getPages().length+1);for(var e=0;e<b.attributes.length;e++){var f=b.attributes[e];f.specified&&(d[f.name]=f.value)}d.doc=c,a.addPage(d)}),console.log("## Pages ##",a.getPages())},b.parseDocuments=function(c){var d,e=angular.element(c);return e.find("text group text").length>0?d="text group text":e.find("text").length>0?d="text":e.find('div[subtype="edition_text"]').length>0&&(d='div[subtype="edition_text"]'),angular.forEach(e.find(d),function(d){for(var e={value:d.getAttribute("xml:id")||b.xpath(c).substr(1)||"doc_"+(a.getDocuments().length+1),label:d.getAttribute("n")||"Doc "+(a.getDocuments().length+1),title:d.getAttribute("n")||"Document "+(a.getDocuments().length+1),content:d},f=0;f<d.attributes.length;f++){var g=d.attributes[f];g.specified&&(e[g.name]=g.value)}a.addDocument(e),b.parsePages(d,e.value)}),console.log("## Documents ##",a.getDocuments()),a.getDocuments()},b}]),angular.module("evtviewer.dataHandler").service("evtCriticalParser",["$q","parsedData","evtParser","xmlParser","config",function(a,b,c,d,e){var f={},g="<app>",h="<lem>",i=h+", <rdg>",j="<rdgGrp>",k="<evt-reading>,<pb>,"+g+","+i+","+j,l=e.skipWitnesses.split(",").filter(function(a){return 0!==a.length});f.findCriticalEntryById=function(a,b){if(void 0!==a){var c=b.replace(/\w-/g,"$&0>").replace(/[0-9]+/g,":eq($&)").replace(/-:eq/g,":eq"),d=$(a).find(c);r(d.get(0))}else console.log("ERROR")};var m=function(a,d){var f={id:d.getAttribute("xml:id"),name:"",content:[],_type:"group",_group:void 0,text:{}};return angular.forEach(d.childNodes,function(d){if(1===d.nodeType)if("head"===d.tagName)f.name=d.innerHTML;else if(e.listDef.indexOf(d.tagName)>=0){var g=m(a,d);g._group=f.id,b.addElementInWitnessCollection(g),f.content.push(g.id)}else if(e.versionDef.indexOf(d.tagName)>=0){var h={id:d.getAttribute("xml:id"),description:c.parseXMLElement(a,d,""),_group:f.id,_type:"witness"};l.indexOf(h.id)<0&&(b.addElementInWitnessCollection(h),f.content.push(h.id))}}),f};f.parseWitnesses=function(a){var d=angular.element(a);d.find(e.listDef).length>0?angular.forEach(d.find(e.listDef),function(d){c.isNestedInElem(d,d.tagName)||angular.forEach(d.childNodes,function(d){if(1===d.nodeType){var f={};e.listDef.indexOf(d.tagName)>=0?f=m(a,d):e.versionDef.indexOf(d.tagName)>=0&&(f={id:d.getAttribute("xml:id"),description:c.parseXMLElement(a,d,""),_group:void 0,_type:"witness",text:{}}),b.addElementInWitnessCollection(f)}})}):console.log("ERROR: "+e.listDef+" missing. Please add this element to make EVT work properly."),console.log("## Witnesses ##",b.getWitnesses())};var n=function(a){if(e.lacunaMilestone.indexOf("<"+a.tagName+">")<0&&e.fragmentMilestone.indexOf("<"+a.tagName+">")<0){var b={tagName:a.tagName,type:"genericElement",attributes:[],content:[]};if(a.attributes)for(var c=0;c<a.attributes.length;c++){var d=a.attributes[c];d.specified&&(b.attributes[d.name]=d.value)}return angular.forEach(a.childNodes,function(c){if(3===c.nodeType)""!==c.textContent.trim()&&b.content.push(c.textContent.trim());else if("<"+c.tagName+">"===g){var d=r(c);b.content.push({id:d.id,type:"subApp"})}else{if(e.fragmentMilestone.indexOf(c.tagName)>=0&&null===c.getAttribute("wit")){var f=a.getAttribute("wit");c.setAttribute("wit",f)}if(e.lacunaMilestone.indexOf(c.tagName)>=0&&null===c.getAttribute("wit")){var h=a.getAttribute("wit");c.setAttribute("wit",h)}b.content.push(angular.element(c).find(g.replace(/[<>]/g,""))?n(c):c.cloneNode(!0))}}),b}return a},o=function(a,d){var f,h={id:"",attributes:[],content:[],note:"",_significant:!0,_group:void 0,_xmlTagName:d.tagName,_xmlSource:d.outerHTML};f=d.getAttribute("xml:id")?"rdg_"+d.getAttribute("xml:id"):c.xpath(d).substr(1),h.id=f;for(var i=0;i<d.attributes.length;i++){var j=d.attributes[i];if(j.specified){if(h.attributes[j.name]=j.value,"wit"===j.name||"source"===j.name){var k=j.value.split("#").filter(function(a){return 0!==a.length});h.wits=[];for(var l in k){var m=k[l].replace(" ","");if(void 0!==b.getWitness(m))if(b.isWitnessesGroup(m)){var o=b.getWitnessesInGroup(m);h.wits.push.apply(h.wits,o);for(var p in o)void 0===a._indexes.witMap[o[p]]&&(a._indexes.witMap[o[p]]=f)}else h.wits.push(m),void 0===a._indexes.witMap[m]&&(a._indexes.witMap[m]=f)}}h._significant&&e.notSignificantVariant.indexOf("["+j.name+"="+j.value+"]")>=0&&(h._significant=!1),b.addCriticalEntryFilter(j.name,j.value)}}return angular.forEach(d.childNodes,function(b){if(3===b.nodeType)""!==b.textContent.trim()&&h.content.push(b.textContent.trim());else if("note"===b.tagName)h.note=b.innerHTML;else if(g.indexOf("<"+b.tagName+">")>=0){var c=r(b,a.id);h.content.push({id:c.id,type:"subApp"}),a._indexes.subApps.push(c.id)}else{if(h._significant&&e.notSignificantVariant.indexOf("<"+b.tagName+">")>=0&&(h._significant=!1),e.fragmentMilestone.indexOf(b.tagName)>=0&&null===b.getAttribute("wit")){var f=d.getAttribute("wit");b.setAttribute("wit",f)}if(e.lacunaMilestone.indexOf(b.tagName)>=0&&null===b.getAttribute("wit")){var i=d.getAttribute("wit");b.setAttribute("wit",i)}h.content.push(angular.element(b).find(g.replace(/[<>]/g,""))?n(b):b.cloneNode(!0))}}),h},p=function(a,d){var f,g={attributes:[],content:[]};f=d.getAttribute("xml:id")?"rdg_"+d.getAttribute("xml:id"):c.xpath(d).substr(1),g.id=f,angular.forEach(d.childNodes,function(c){if(i.indexOf("<"+c.tagName+">")>=0){var f=o(a,c);f._group=g.id,g.content.push(f.id);for(var h=0;h<d.attributes.length;h++){var k=d.attributes[h];k.specified&&(g.attributes[k.name]=k.value,void 0===f.attributes[k.name]&&(f.attributes[k.name]=k.value,f._significant&&e.notSignificantVariant.indexOf("["+k.name+"="+k.value+"]")>=0&&(f._significant=!1)),b.addCriticalEntryFilter(k.name,k.value))}a._indexes.readings._indexes.push(f.id),a.content[f.id]=f,(f._significant||"lem"===c.tagName)&&a._indexes.readings._significant.push(f.id)}else j.indexOf("<"+c.tagName+">")>=0}),a._indexes.groups.push(g.id),a.content[g.id]=g,a._indexes.encodingStructure.push(g.id)},q=function(a){var d,e={id:"",attributes:[],lemma:"",note:"",content:{},_indexes:{encodingStructure:[],readings:{_indexes:[],_significant:[]},groups:[],subApps:[],witMap:{}},_subApp:!1,_xmlSource:a.outerHTML||""};if(d=a.getAttribute("xml:id")?"app_"+a.getAttribute("xml:id"):c.xpath(a).substr(1),e.id=d,a.attributes)for(var f=0;f<a.attributes.length;f++){var k=a.attributes[f];k.specified&&(e.attributes[k.name]=k.value,b.addCriticalEntryFilter(k.name,k.value))}return e._subApp=c.isNestedInElem(a,g.replace(/[<>]/g,"")),angular.forEach(a.childNodes,function(a){if(1===a.nodeType)if(i.indexOf("<"+a.tagName+">")>=0){var b=o(e,a);h.indexOf("<"+a.tagName+">")>=0?e.lemma=b.id:(e._indexes.readings._indexes.push(b.id),b._significant&&e._indexes.readings._significant.indexOf(b.id)<0&&e._indexes.readings._significant.push(b.id)),e.content[b.id]=b,e._indexes.encodingStructure.push(b.id)}else if(j.indexOf("<"+a.tagName+">")>=0)p(e,a);else if(g.indexOf("<"+a.tagName+">")>=0){var c=r(a,d),f={id:c.id,type:"subApp"};e.content[c.id]=f,e._indexes.encodingStructure.push(c.id),e._indexes.subApp.push(c.id)}else"note"===a.tagName&&(e.note=a.innerHTML)}),e},r=function(a,c){var d=q(a)||void 0;(a.querySelectorAll("rdg lacunaStart").length>0||a.querySelectorAll("rdg lacunaEnd").length>0)&&(d._lacuna=!0),(a.querySelectorAll("rdg witStart").length>0||a.querySelectorAll("rdg witEnd").length>0)&&(d._fragment=!0);var e=d._indexes.readings._significant,f=e.length;""!==d.lemma&&e.indexOf(d.lemma)>=0&&(f-=1);var g=b.getWitnessesList(),h=f/g.length;d._variance=h;var i=Object.keys(d._indexes.witMap),j=[];if(i.length<g.length)for(var k in g)i.indexOf(g[k])<0&&j.push(g[k]);return d._indexes.missingWits=j,c&&(d._indexes._parentEntry=c),b.addCriticalEntry(d),d};f.parseCriticalEntries=function(c){var d=a.defer(),f=angular.element(c);return angular.forEach(f.find(g.replace(/[<>]/g,"")),function(a){r(a)}),b.setCriticalEntriesLoaded(e.loadCriticalEntriesImmediately),console.log("## Critical entries ##",b.getCriticalEntries()),d.resolve("success"),d};var s=function(a,b){return null===a?!1:void 0!==b.group&&a.indexOf("#"+b.group)>=0||a.indexOf("#")>=0&&a.indexOf("#"+b.id)>=0||a.indexOf(b.id)>=0};f.parseWintessPageBreaks=function(a,b){for(var c=a.getElementsByTagName("pb"),d=0;d<c.length;){var e=c[d];if(s(e.getAttribute("ed"),b)){var f,g=document.createElement("span");f=e.getAttribute("ed")?e.getAttribute("xml:id")||e.getAttribute("ed").replace("#","")+"-"+e.getAttribute("n")||"page_"+d:e.getAttribute("xml:id")||"page_"+d,g.className="pb",g.setAttribute("data-wit",e.getAttribute("ed")),g.setAttribute("data-id",f),g.setAttribute("id","pb_"+f),g.textContent=e.getAttribute("n"),e.parentNode.replaceChild(g,e)}else e.parentNode.removeChild(e)}},f.parseWintessLacunas=function(a,d){for(var e,f,g,h=a.getElementsByTagName("lacunaStart"),i=a.getElementsByTagName("lacunaEnd"),j=[],k=[],l=0;l<h.length;l++)e=h[l].parentNode.getAttribute("data-app-id"),f=h[l].parentNode.getAttribute("data-reading-id"),g=b.getCriticalEntryById(e).content[f].wits,void 0!==g&&g.indexOf(d)>=0&&j.push(h[l]);for(var m=0;m<i.length;m++)e=i[m].parentNode.getAttribute("data-app-id"),f=i[m].parentNode.getAttribute("data-reading-id"),g=b.getCriticalEntryById(e).content[f].wits,void 0!==g&&g.indexOf(d)>=0&&k.push(i[m]);if(j.length===k.length)for(var n=j.length-1;n>=0;n--){var o=j[n].parentNode,p=k[n].parentNode,q=o.getAttribute("data-app-id"),r=p.getAttribute("data-app-id"),s="<evt-reading.*data-app-id.*"+q+".*</evt-reading>(.|[\r\n])*?<evt-reading.*data-app-id.*"+r+".*</evt-reading>",t=new RegExp(s,"ig"),u='<span data-app-id-start="'+q+'" data-app-id-end="'+r+'" class="lacuna">[LACUNA]</span>';a.innerHTML=a.innerHTML.replace(t,u),a.innerHTML=c.balanceXHTML(a.innerHTML)}else a.innerHTML='<span class="error">There was a problem in loading lacuna for this witness.</span>'};var t=function(a,b){try{return a.querySelectorAll("witStart[wit*='#"+b+"']").length>0?!0:a.querySelectorAll("rdg[wit*='#"+b+"'] witStart:not([wit]").length>0||a.querySelectorAll("lem[wit*='#"+b+"'] witStart:not([wit]").length>0?!0:!1}catch(c){return!1}};f.parseFragmentaryWitnessText=function(a,c){for(var d,e,f,g=a.getElementsByTagName("witStart"),h=a.getElementsByTagName("witEnd"),i=[],j=[],k=0;k<g.length;k++)d=g[k].parentNode.getAttribute("data-app-id"),e=g[k].parentNode.getAttribute("data-reading-id"),f=b.getCriticalEntryById(d).content[e].wits,void 0!==f&&f.indexOf(c)>=0&&i.push(g[k]);for(var l=0;l<h.length;l++)d=h[l].parentNode.getAttribute("data-app-id"),e=h[l].parentNode.getAttribute("data-reading-id"),f=b.getCriticalEntryById(d).content[e].wits,void 0!==f&&f.indexOf(c)>=0&&j.push(h[l]);var m="";if(g.length===h.length){for(var n=i.length-1;n>=0;n--){var o=i[n].parentNode,p=j[n].parentNode,q=o.getAttribute("data-app-id"),r=p.getAttribute("data-app-id"),s='<evt-reading data-app-id="'+q+".*</evt-reading>(.|[\r\n])*?<evt-reading data-app-id.*"+r+".*</evt-reading>",t=new RegExp(s,"ig");m='<span class="fragment fragment-start"></span>'+a.innerHTML.match(t)+'<span class="fragment fragment-end"></span>'+m}return m}return'<span class="error">There was a problem in loading fragmentary witness.</span>'};var u=function(a,c){var d;if(null!==a){var e=a._indexes.readings._indexes;if(d=document.createElement("evt-reading"),""!==a.lemma&&!a._lacuna&&1===e.length){var f=a.content[e[0]].wits||[];f.length===b.getWitnessesList().length&&(d=document.createElement("span"),d.className=a.content[e[0]]._xmlTagName)}d.setAttribute("data-app-id",a.id),d.setAttribute("data-scope-wit",c);var g=a._indexes.witMap[c];if(void 0!==g&&""!==g){d.setAttribute("data-reading-id",g);var h=a.content[g].content;if(h.length>0)for(var i in h)if("string"==typeof h[i])d.appendChild(document.createTextNode(h[i]));else if("subApp"===h[i].type){var j=b.getCriticalEntryById(h[i].id),k=u(j,c),l=j._indexes.witMap[c]||"";k.setAttribute("data-reading-id",l),null!==k&&d.appendChild(k)}else if("genericElement"===h[i].type){var m=v(h[i],c);d.appendChild(m)}else d.appendChild(h[i]);else if(a._lacuna){var n=document.createElement("span");n.className="lacunaApp icon-evt_note",d.appendChild(n)}else{var o=document.createElement("span");o.className="omission",d.appendChild(o)}}else if(a.lemma)d=w(a,c);else{var p=document.createElement("span");p.className="empty",p.setAttribute("title","noRdg"),d.appendChild(p)}}else{var q=document.createElement("span");q.className="encodingError",q.setAttribute("title","General error"),d.appendChild(q)}return d.setAttribute("data-type","variant"),d};f.parseWitnessText=function(d,h,i){var j,l=a.defer();if(void 0!==d){d=d.cloneNode(!0);for(var m=d.getElementsByTagName("body")[0],n=b.getWitness(i),o=m.getElementsByTagName(g.replace(/[<>]/g,"")),p=o.length-1;p<o.length&&p>=0;){var q=o[p];if(!c.isNestedInElem(q,g.replace(/[<>]/g,""))){var s;s=q.getAttribute("xml:id")?"app_"+q.getAttribute("xml:id"):c.xpath(q).substr(1);var v,w=b.getCriticalEntryById(s);if(!e.loadCriticalEntriesImmediately&&void 0===w){r(q);var x=q.getElementsByTagName(g.replace(/[<>]/g,""));if(x.length>0)for(var y=0;y<x.length;y++)r(x[y]);w=b.getCriticalEntryById(s)}void 0!==w?v=u(w,i):(v=document.createElement("span"),v.className="encodingError"),null!==v&&q.parentNode.replaceChild(v,q)}p--}if(m.innerHTML=m.innerHTML.replace(/>[\s\r\n]*?</g,"><"),angular.forEach(m.children,function(a){var b=k+","+e.lacunaMilestone+","+e.fragmentMilestone;a.parentNode.replaceChild(c.parseXMLElement(d,a,b),a)
}),f.parseWintessPageBreaks(m,n),f.parseWintessLacunas(m,i),t(m,i)){m.innerHTML=m.innerHTML.replace(/xmlns="http:\/\/www\.w3\.org\/1999\/xhtml"/g,"");var z=f.parseFragmentaryWitnessText(m,i);j=c.balanceXHTML(z)}else j=m.innerHTML}else j="<span>Text not available.</span>";return j=c.balanceXHTML(j),b.addWitnessText(i,h,j),l.resolve("success"),l};var v=function(a,c){var d=document.createElement("span");d.className=a.tagName;var e=Object.keys(a.attributes);for(var f in e){var g=e[f],h=a.attributes[g];"xml:id"!==g&&d.setAttribute("data-"+g,h)}var i=a.content;for(var j in i)if("string"==typeof i[j])d.appendChild(document.createTextNode(i[j]));else if("subApp"===i[j].type){var k=b.getCriticalEntryById(i[j].id),l=""===c?w(k,c):u(k,c),m=k._indexes.witMap[c]||"";l.setAttribute("data-reading-id",m),null!==l&&d.appendChild(l)}else if("genericElement"===i[j].type){var n=v(i[j],c);d.appendChild(n)}return d},w=function(a,c){var d,f;if(null!==a){if(d=document.createElement("evt-reading"),d.setAttribute("data-app-id",a.id),d.setAttribute("data-scope-wit",c),d.setAttribute("data-type","lemma"),a._lacuna){var g=document.createElement("span");g.className="lacunaApp icon-evt_note",d.appendChild(g)}else if(void 0!==a.lemma&&""!==a.lemma){d.setAttribute("data-reading-id",a.lemma);var h=a.content[a.lemma].content;for(var i in h)if("string"==typeof h[i])d.appendChild(document.createTextNode(h[i]));else if("subApp"===h[i].type){var j=b.getCriticalEntryById(h[i].id),k=""===c?w(j,c):u(j,c),l=j._indexes.witMap[c]||"";k.setAttribute("data-reading-id",l),null!==k&&d.appendChild(k)}else if("genericElement"===h[i].type){var m=v(h[i],c);d.appendChild(m)}}else""!==e.preferredWitness?(d=u(a,e.preferredWitness),null!==d&&(d.className="autoLemma")):(f=document.createElement("span"),f.className="encodingError",f.setAttribute("title","General error"),d.appendChild(f));if(null!==d){var n=Object.keys(a.attributes);for(var o in n){var p=n[o],q=a.attributes[p];"xml:id"!==p&&d.setAttribute("data-"+p.replace(":","-"),q)}void 0!==a._variance&&d.setAttribute("data-variance",a._variance)}}else f=document.createElement("span"),f.className="encodingError",f.setAttribute("title","General error"),d.appendChild(f);return d};return f.parseCriticalText=function(d,f){var h,i=a.defer();if(void 0!==d){d=d.cloneNode(!0);for(var j=d.getElementsByTagName("body")[0],l=j.getElementsByTagName(g.replace(/[<>]/g,"")),m=l.length-1,n=0;m<l.length&&m>=0;){var o=l[m];if(!c.isNestedInElem(o,g.replace(/[<>]/g,""))){var p;p=o.getAttribute("xml:id")?"app_"+o.getAttribute("xml:id"):c.xpath(o).substr(1);var q,s=b.getCriticalEntryById(p);if(!e.loadCriticalEntriesImmediately||void 0===s){r(o);var t=o.getElementsByTagName(g.replace(/[<>]/g,""));if(t.length>0)for(var u=0;u<t.length;u++)r(t[u]);s=b.getCriticalEntryById(p)}void 0!==s?q=w(s,""):(q=document.createElement("span"),q.className="errorMsg",q.textContent="ERROR"),null!==q&&o.parentNode.replaceChild(q,o),n++}m--}for(var v=j.getElementsByTagName("pb"),x=0;x<v.length;){var y=v[x];y.parentNode.removeChild(y)}angular.forEach(j.children,function(a){var b=k+","+e.lacunaMilestone+","+e.fragmentMilestone;a.parentNode.replaceChild(c.parseXMLElement(d,a,b),a)}),h=j.outerHTML}else h="<span>Text not available.</span>";if(void 0===h){var z='<span class="alert-msg alert-msg-error">There was an error in the parsing of the text. <br />Try a different browser or contact the developers.</span>';h=z}return b.addCriticalText(h,f),i.resolve("success"),i},f}]),angular.module("evtviewer.dataHandler").service("evtCriticalApparatus",["parsedData","evtParser","config",function(a,b,c){var d={},e=c.skipWitnesses.split(",").filter(function(a){return 0!==a.length});return d.getContent=function(a,b,c){var e={attributes:{values:a.attributes||{},_keys:Object.keys(a.attributes)||[]},lemma:{content:"",attributes:{values:{},_keys:[]}},significantReadings:[],notSignificantReadings:[],readingGroups:[],criticalNote:""},f=a.content[a.lemma];void 0!==f&&(e.lemma.content+='<span class="app_lemma_content">'+d.getLemma(f,c)+"</span>",e.lemma.attributes.values=f.attributes||{},e.lemma.attributes._keys=Object.keys(f.attributes)||[]);for(var g=a._indexes.readings,h=g._indexes,i=0;i<h.length;i++){var k=a.content[h[i]];void 0!==k&&(g._significant.indexOf(k.id)>=0?e.significantReadings.push(d.getSignificantReading(k,c)):e.notSignificantReadings.push(d.getSignificantReading(k,c)))}if(!b&&a._indexes.groups.length>0)for(var i=0;i<a._indexes.groups.length;i++){var l=a.content[a._indexes.groups[i]];if(void 0!==l){var m=[];for(j in l.attributes)m.push({label:j,values:l.attributes[j]});for(var n=[],o=0;o<l.content.length;o++){var p=a.content[l.content[o]];void 0!==p&&n.push(d.getSignificantReading(p,c))}n.length>0&&e.readingGroups.push({header:m,readings:n})}}return e.criticalNote+=a.note,e},d.getGenericContent=function(a,b){var c;c='<span class="'+a.tagName+' inApparatus">';for(var e=0;e<a.content.length;e++)c+="string"==typeof a.content[e]?a.content[e]:"subApp"===a.content[e].type?d.getSubApparatus(a.content[e].id,b):"genericElement"===a.content[e].type?d.getGenericContent(a.content[e],b):a.content[e].outerHTML;return c+="</span>"},d.getLemma=function(a,b){for(var c="",e=0;e<a.content.length;e++)c+="subApp"===a.content[e].type?d.getSubApparatus(a.content[e].id,b):"genericElement"===a.content[e].type?d.getGenericContent(a.content[e],b):a.content[e];return c=d.transformCriticalEntryLacunaMilestones(c),""!==c&&(c+=d.getCriticalEntryWitnesses(a,"lem",b)),c=c.replace(/ xmlns="http:\/\/www\.tei-c\.org\/ns\/1\.0"/g,""),c=d.transformCriticalEntryFragmentMilestones(c)},d.getSubApparatus=function(b,c){var e="",f=a.getCriticalEntryById(b),g=d.getContent(f,!0,c);e+='<span class="sub_app"> (('+g.lemma.content+" ";for(var h=0;h<g.significantReadings.length;h++)e+=g.significantReadings[h].content,h<g.significantReadings.length-1&&(e+="; ");return e+=")) </span>"},d.getSignificantReading=function(a,b){for(var c="",e={},f=0;f<a.content.length;f++)c+="string"==typeof a.content[f]?a.content[f]:"subApp"===a.content[f].type?d.getSubApparatus(a.content[f].id,b):"genericElement"===a.content[f].type?d.getGenericContent(a.content[f],b):a.content[f].outerHTML;""===c&&(c=" <i>omit.</i> "),c=d.transformCriticalEntryLacunaMilestones(c);var g=d.getCriticalEntryWitnesses(a,"rdg",b);return(void 0===a.wits||""!==g)&&(c+=g,c=c.replace(/ xmlns="http:\/\/www\.tei-c\.org\/ns\/1\.0"/g,""),c=d.transformCriticalEntryFragmentMilestones(c),e={content:c,attributes:{values:a.attributes||{},_keys:Object.keys(a.attributes)||[]}}),e},d.getCriticalEntryWitnesses=function(a,b,c){var d="";if(void 0!==a.wits)for(wit in a.wits)e.indexOf(wit)<0&&(d+='<evt-witness-ref witness="'+a.wits[wit]+'" data-scope-wit="'+c+'"></evt-witness-ref>');return""!==d&&(d='<span class="witnesses witnesses-'+b+'">'+d+"</span>"),d},d.getCriticalEntryAttributes=function(a){var b="";if(void 0!==a.attributes)for(var c in a.attributes)"wit"!==c&&"xml:id"!==c&&(b+='<span class="'+c+'">'+c+": "+a.attributes[c]+"</span>");return""!==b&&(b='<span class="attributes" style="display:none">'+b+"</span>"),b},d.transformCriticalEntryLacunaMilestones=function(a){return a=a.replace(/<lacunaStart(.|[\r\n])*?\/>/gi,"<i>beginning of a lacuna in </i>"),a=a.replace(/<lacunaEnd(.|[\r\n])*?\/>/gi,"<i>end of a lacuna in </i>")},d.transformCriticalEntryFragmentMilestones=function(a){var b=a.match(/<witStart(.|[\r\n])*?\/>/gi);if(null!==b)for(var c=0;c<b.length;c++){var d=b[c],e=d.match(/"#.*"/g);e=null!==e?" of "+e[0].replace(/["#]/g,""):"";var f=new RegExp(d,"ig");a=a.replace(f,"<i> [beginning of fragment"+e+"] </i>")}var g=a.match(/<witEnd(.|[\r\n])*?\/>/gi);if(null!==g)for(var c=0;c<g.length;c++){var d=g[c],e=d.match(/"#.*"/g);e=null!==e?" of "+e[0].replace(/["#]/g,""):"";var f=new RegExp(d,"ig");a=a.replace(f,"<i> [end of fragment"+e+"] </i>")}return a},d}]),angular.module("evtviewer.dataHandler").service("evtProjectInfoParser",["$q","parsedData","evtParser","xmlParser",function(a,b,c){var d={},e="<teiHeader>",f="<fileDesc>",g="<encodingDesc>",h="<profileDesc>",i="<xenoData>",j="<revisionDesc>";d.parseProjectInfo=function(a){var b=angular.element(a);angular.forEach(b.find(e.replace(/[<>]/g,"")),function(a){d.parseEditionReference(a),d.parseFileDescription(a),d.parseEncodingDescription(a),d.parseTextProfile(a),d.parseOutsideMetadata(a),d.parseRevisionHistory(a)})};var k="<publicationStmt>",l="<titleStmt>";return d.parseEditionReference=function(a){var c=angular.element(a),d=c.find(l.replace(/[<>]/g,"")+" title")[0],e=c.find(l.replace(/[<>]/g,"")+" author")[0],f=c.find(k.replace(/[<>]/g,"")+" publisher")[0],g={title:d?d.textContent:"",author:e?e.textContent:"",publisher:f?f.textContent:""};b.updateProjectInfoContent(g,"editionReference")},d.parseFileDescription=function(a){var d=angular.element(a);angular.forEach(d.find(f.replace(/[<>]/g,"")),function(d){if(d.children.length>0){var e=c.parseXMLElement(a,d,"evtNote").outerHTML;b.updateProjectInfoContent(e,"fileDescription")}})},d.parseEncodingDescription=function(a){var d=angular.element(a);angular.forEach(d.find(g.replace(/[<>]/g,"")),function(d){if(d.children.length>0){var e=angular.element(d).find("variantEncoding")[0];if(e){var f=c.parseXMLElement(a,d,"evtNote").outerHTML;f+='<span class="variantEncoding">This edition is using <i>',f+=e.getAttribute("method"),f+=" method</i> to encode text-critical variants.</span>"}b.updateProjectInfoContent(f,"encodingDescription")}})},d.parseTextProfile=function(a){var d=angular.element(a);angular.forEach(d.find(h.replace(/[<>]/g,"")),function(d){if(d.children.length>0){var e=c.parseXMLElement(a,d,"evtNote").outerHTML;b.updateProjectInfoContent(e,"textProfile")}})},d.parseOutsideMetadata=function(a){var d=angular.element(a);angular.forEach(d.find(i.replace(/[<>]/g,"")),function(d){if(d.children.length>0){var e=c.parseXMLElement(a,d,"evtNote").outerHTML;b.updateProjectInfoContent(e,"outsideMetadata")}})},d.parseRevisionHistory=function(a){var d=angular.element(a);angular.forEach(d.find(j.replace(/[<>]/g,"")),function(d){var e=c.parseXMLElement(a,d,"evtNote").outerHTML;b.updateProjectInfoContent(e,"revisionHistory")})},d}]),angular.module("evtviewer.interface",[]),angular.module("evtviewer.interface").config(["$routeProvider",function(a){a.when("/:viewMode",{template:"index.html",controller:"InterfaceCtrl",reloadOnSearch:!1}).otherwise({redirectTo:"/",reloadOnSearch:!1})}]).run(["$injector","config",function(a,b){if(b.isValid()&&b.isModuleActive("interface")){var c=a.get("evtInterface");c.boot()}}]),angular.module("evtviewer.interface").controller("InterfaceCtrl",["$log","$timeout","$injector","$scope","$route","evtInterface","evtButtonSwitch","evtBox","parsedData","evtSelect","evtPopover","evtCommunication","evtDialog",function(a,b,c,d,e,f,g,h,i,j,k,l,m){var n=a.getInstance("interface");d.getCurrentViewMode=function(){return f.getCurrentViewMode()},d.getCurrentPage=function(){return f.getCurrentPage()},d.getCurrentDocument=function(){return f.getCurrentDocument()},d.getCurrentEdition=function(){return f.getCurrentEdition()},d.getAvailableWitnesses=function(){return f.getAvailableWitnesses()},d.isWitnessSelectorActive=function(){return f.getProperty("witnessSelector")},d.addWitness=function(a){void 0!==a&&(f.addWitness(a),f.updateUrl()),b(function(){var a=window.getComputedStyle(document.getElementsByClassName("box")[0]).width.replace("px","");document.getElementById("compareWits_box").scrollLeft=a*(f.getCurrentWitnesses().length+1)}),f.updateProperty("witnessSelector",!1)},d.getWitness=function(a){var b=a+" - "+i.getWitness(a).description.textContent.trim()||a;return b=b.length>30?b.substr(0,30)+"...":b},d.getCurrentWitnesses=function(){return f.getCurrentWitnesses()},d.getCurrentWitnessPage=function(a){return f.getCurrentWitnessPage(a)},d.getAvailableViewModes=function(){return f.getAvailableViewModes()},d.existCriticalText=function(){return f.existCriticalText()},d.getCurrentAppEntry=function(){return f.getCurrentAppEntry()},d.updateCurrentAppEntry=function(a){f.updateCurrentAppEntry(a),"critical"===f.getCurrentViewMode()&&h.alignScrollToApp(a),f.updateUrl()},d.getPinnedEntries=function(){return f.getPinnedEntries()},d.isLoading=function(){var a=l.getError();return f.isLoading()&&""===a.title},d.isPinnedAppBoardOpened=function(){return f.isPinnedAppBoardOpened()},d.isToolAvailable=function(a){return f.isToolAvailable(a)},d.getSecondaryContentOpened=function(){return f.getSecondaryContentOpened()},d.getProjectInfo=function(){return i.getProjectInfo()},d.getWitnessesListFormatted=function(){return i.getWitnessesListFormatted()},d.getProperty=function(a){return f.getProperty(a)},d.handleGenericClick=function(a){var b=a.target;if(0===$(b).parents("evt-select").length&&j.closeAll(),0===$(b).parents("button-switch").length){var c=["standAlone","toggler"];g.unselectAllSkipByBtnType("",c)}0===$(b).parents("evt-popover").length&&k.closeAll(),0===$(b).parents(".witnessSelector").length&&f.getProperty("witnessSelector")&&f.updateProperty("witnessSelector",!1)},d.handleKeydownEvent=function(a){27===a.keyCode&&m.closeAll()},d.getBookmark=function(){var a=i.getProjectInfo().editionReference||{},b='<div class="bookmark">';return b+=a.author?a.author+". ":"",b+=a.title?"<em>"+a.title+"</em>. ":"",b+=a.publisher?"Published by "+a.publisher+". ":"",b+='<<a href="'+window.location+'" target="blank">'+window.location+"</a>>",b+="</div>"},d.getErrorMsg=function(){return l.getError()},n.log("InterfaceCtrl running")}]).directive("ref",[function(){return{restrict:"C",scope:{target:"@"},template:'<a href="{{target}}" ng-transclude></a>',replace:!0,transclude:!0,link:function(){}}}]),angular.module("evtviewer.interface").service("evtInterface",["evtCommunication","evtCriticalParser","evtCriticalApparatusEntry","config","$routeParams","parsedData","evtReading","$q",function(a,b,c,d,e,f,g,h){var i={},j={currentViewMode:void 0,currentDoc:void 0,currentPage:void 0,currentWits:void 0,currentWitsPages:void 0,currentEdition:void 0,currentAppEntry:void 0,isLoading:!0,isPinnedAppBoardOpened:!1,secondaryContent:""},k={indexTitle:"",availableViewModes:[],availableWitnesses:[],witnessSelector:!1};return i.boot=function(){a.getExternalConfig(d.configUrl).then(function(){k.indexTitle=d.indexTitle,k.availableViewModes=d.availableViewModes,a.getData(d.dataUrl).then(function(){i.updateParams(e);var a=f.getDocument(j.currentDoc);if(void 0!==a){var g=[];d.loadCriticalEntriesImmediately&&g.push(b.parseCriticalEntries(a.content).promise),g.push(b.parseCriticalText(a.content,j.currentDoc).promise),h.all(g).then(function(){void 0!==j.currentAppEntry&&void 0===f.getCriticalEntryById(j.currentAppEntry)&&(i.updateCurrentAppEntry(""),i.updateUrl()),j.isLoading=!1;var a=document.cookie.split(";");for(var b in a){var d=a[b].split("=");if("pinned"===d[0].trim()){var e=d[1].split(",").filter(function(a){return 0!==a.length&&void 0!==f.getCriticalEntryById(a)});e.length>0&&c.setPinned(e)}}})}})})},i.isLoading=function(){return j.isLoading},i.isToolAvailable=function(a){return d[a]},i.getProperties=function(){return k},i.getProperty=function(a){return k[a]},i.getAvailableViewModes=function(){return k.availableViewModes},i.getCurrentViewMode=function(){return j.currentViewMode},i.getCurrentPage=function(){return j.currentPage},i.getCurrentDocument=function(){return j.currentDoc},i.getCurrentEdition=function(){return j.currentEdition},i.getAvailableWitnesses=function(){return k.availableWitnesses},i.getCurrentWitnesses=function(){return j.currentWits},i.getCurrentWitnessesPages=function(){return j.currentWitsPages},i.getCurrentWitnessPage=function(a){return j.currentWitsPages[a]},i.getCurrentAppEntry=function(){return j.currentAppEntry},i.existCriticalText=function(){return void 0!==f.getCriticalText(j.currentDoc)},i.isPinnedAppBoardOpened=function(){return j.isPinnedAppBoardOpened},i.getPinnedEntries=function(){return c.getPinned()},i.getSecondaryContentOpened=function(){return j.secondaryContent},i.setLoading=function(a){a.isLoading=a},i.togglePinnedAppBoardOpened=function(){j.isPinnedAppBoardOpened=!j.isPinnedAppBoardOpened},i.updateProperty=function(a,b){k[a]=b},i.updateSecondaryContentOpened=function(a){j.secondaryContent=a},i.updateCurrentViewMode=function(a){j.currentViewMode=a},i.updateCurrentPage=function(a){j.currentPage=a},i.updateCurrentDocument=function(a){j.currentDoc=a},i.updateCurrentEdition=function(a){j.currentEdition=a},i.removeAvailableWitness=function(a){var b=k.availableWitnesses.indexOf(a);void 0!==b&&k.availableWitnesses.splice(b,1)},i.updateWitnessesPage=function(a,b){j.currentWitsPages[a]=b},i.updateCurrentWitnesses=function(a){j.currentWits=a},i.updateCurrentWitnessesPages=function(a){j.currentWitsPages=a},i.addWitness=function(a){j.currentWits.push(a),i.removeAvailableWitness(a)},i.addWitnessAtIndex=function(a,b){j.currentWits.splice(b,0,a),i.removeAvailableWitness(a)},i.removeWitness=function(a){var b=j.currentWits.indexOf(a);b>=0&&(j.currentWits.splice(b,1),delete j.currentWitsPages[a]),k.availableWitnesses.indexOf(a)<0&&k.availableWitnesses.push(a)},i.switchWitnesses=function(a,b){var c=j.currentWits.indexOf(b),d=j.currentWits.indexOf(a);c>=0&&(j.currentWits[c]=a),j.currentWits[d]=b},i.updateCurrentAppEntry=function(a){j.currentAppEntry=a},i.updateParams=function(a){var b,c,e,h,j=d.defaultViewMode,l=d.defaultEdition,m=[],n={};if(void 0!==a.viewMode&&(j=a.viewMode),void 0!==a.edition?l=a.edition:"critical"===j&&(l="critical"),void 0!==a.pageId)b=a.pageId;else{var o=f.getPages();o.length>0&&(b=o[o[0]].value||void 0)}if(void 0!==a.d&&void 0!==f.getDocument(a.d))c=a.d;else{var p=f.getDocuments();p.length>0&&(c=p[p[0]].value||void 0)}if(void 0!==a.ws){e=a.ws.split(",").filter(function(a){return 0!==a.length});var q=f.getWitnessesList();k.availableWitnesses=q.slice(0,q.length);for(var r in e){var s=e[r].split("@")[0],t=e[r].split("@")[1];void 0!==f.getWitness(s)&&(m.push(s),i.removeAvailableWitness(s),void 0!==t&&void 0!==f.getPage(s+"-"+t)&&(n[s]=t))}}else if("collation"===j)m=f.getWitnessesList(),m.length>d.maxWitsLoadTogether?(k.availableWitnesses=m.slice(d.maxWitsLoadTogether),m=m.slice(0,d.maxWitsLoadTogether)):k.availableWitnesses=[];else{var q=f.getWitnessesList();k.availableWitnesses=q.slice(0,q.length)}void 0!==a.app&&(h=a.app),void 0!==j&&i.updateCurrentViewMode(j),void 0!==l?i.updateCurrentEdition(l):"collation"===j&&i.updateCurrentEdition("critical"),void 0!==b&&i.updateCurrentPage(b),void 0!==c&&i.updateCurrentDocument(c),void 0!==m&&i.updateCurrentWitnesses(m),n!=={}&&i.updateCurrentWitnessesPages(n),void 0!==h&&(i.updateCurrentAppEntry(h),g.setCurrentAppEntry(h)),i.updateUrl()},i.updateUrl=function(){var a=j.currentViewMode,b="";if(b+=void 0===j.currentDoc?"":(""===b?"":"&")+"d="+j.currentDoc,b+=void 0===j.currentPage?"":(""===b?"":"&")+"p="+j.currentPage,b+=void 0===j.currentEdition?"":(""===b?"":"&")+"e="+j.currentEdition,"collation"===a&&void 0!==j.currentWits&&j.currentWits.length>0){""!==b&&(b+="&"),b+="ws=";for(var c in j.currentWits){var d=j.currentWits[c],e=i.getCurrentWitnessPage(d);b+=d,void 0!==e&&(b+="@"+e),c<j.currentWits.length-1&&(b+=",")}}void 0!==j.currentAppEntry&&""!==j.currentAppEntry&&(""!==b&&(b+="&"),b+="app="+j.currentAppEntry),void 0!==a&&(window.location="#/"+a+"?"+b)},i}]),angular.module("evtviewer.communication",[]),angular.module("evtviewer.communication").constant("COMMUNICATIONDEFAULTS",{mode:"xml",errorMsgs:{404:{title:"File not found",msg:"Something wrong during loading file"}}}).service("evtCommunication",["$http","$log","baseData","config","evtDialog","COMMUNICATIONDEFAULTS",function(a,b,c,d,e,f){var g={},h=f,i=b.getInstance("communication"),j={code:"",title:"",msg:""};return g.getExternalConfig=function(b){return a.get(b).success(function(a){d.extendDefault(a)}).error(function(a,b){g.err("Something wrong while loading configuration file",b)})},g.getData=function(b){return a.get(b).success(function(a){"string"==typeof a&&(c.addXMLString(a),i.log("XML Data received"))}).error(function(a,c){g.err(h.errorMsgs[c].msg+' "'+b+'"',c)})},g.getError=function(){return j},g.updateError=function(a){j=a},g.err=function(a,b){b=void 0!==b?b:"";var c={code:b,msg:a,title:h.errorMsgs[b]?"Error "+b+" - "+h.errorMsgs[b].title:"Communication error "+b};g.updateError(c);var d=e.getById("errorMsg");d.updateContent(j.msg),d.setTitle(j.title),d.open()},g}]),angular.module("evtviewer.box",[]),angular.module("evtviewer.box").constant("BOXDEFAULTS",{menuClosed:!1}).config(["evtBoxProvider","configProvider","BOXDEFAULTS",function(a,b,c){var d=b.makeDefaults("box",c);a.setDefaults(d)}]),angular.module("evtviewer.box").provider("evtBox",function(){var a=this.defaults;this.setDefaults=function(b){a=b},this.$get=["$log","$q","config","parsedData","evtCriticalParser","xmlParser","evtInterface",function(b,c,d,e,f,g,h){function i(a,b){var c=this;return c.state[a]=b,c.state[a]}function j(a){var b=this;return b.state[a]}function k(){var a=this.uid;delete w[a]}function l(a,b){var c=this,d=c.state.filters;void 0===d[a]&&(d[a]={name:a,any:!0,totActive:0,values:{length:0}}),void 0===d[a].totActive&&(d[a].totActive=0);var f=d[a].values;void 0===f[b]?(f[f.length]=b,f[b]={name:b,active:!0,color:e.getCriticalEntriesFilterColor(a,b)},f.length++):f[b].active=!f[b].active,f[b].active?(d[a].totActive++,d._totActive++):(d[a].totActive--,d._totActive--),d[a].any=0===d[a].totActive}function m(a){var b=this;b.state.filters[a].values={length:0},b.state.filters._totActive-=b.state.filters[a].totActive,b.state.filters[a].totActive=0}function n(){var a=this;void 0!==a.state.topBoxOpened&&(a.state.topBoxOpened=!a.state.topBoxOpened)}function o(){var a=this;void 0!==a.state.filterBox&&(a.state.filterBox=!a.state.filterBox)}function p(a){var b=this;b.topBoxContent=a}function q(){var a=this;return"font-size:"+a.state.fontSize+"%"||""}function r(){var a=this;a.state.fontSize=parseInt(a.state.fontSize)+4}function s(){var a=this;a.state.fontSize=parseInt(a.state.fontSize)-4}function t(){var a=this;a.state.fontSize="100"}function u(a){a=!a}{var v={},w={},x=[],y=0;b.getInstance("box")}return v.build=function(b,g){var v,z,A=g.id||y++,B=g.type||"default",C={selectors:[],buttons:[]},D={selectors:[],buttons:[]},E='<span class="alert-msg">No info available</span>',F={topBoxOpened:!1,fontSizeBtn:!1,fontSize:"100",topBoxContent:""},G=[],H=!0,I={fontSizeBtn:[{title:"Reset font size",label:"",icon:"font-size-reset",type:"fontSizeReset"},{title:"Decrease font size",label:"",icon:"font-size-minus",type:"fontSizeDecrease"},{title:"Increase font size",label:"",icon:"font-size-plus",type:"fontSizeIncrease"}]},J={};if("undefined"==typeof w[A]){var K;switch(B){case"image":C.selectors.push({id:"page_"+A,type:"page",initValue:h.getCurrentPage()}),C.buttons.push({title:"Thumbnails",label:"Thumbs",icon:"thumbs",type:"thumbs"}),z=function(){b.vm.isLoading=!0;var a=h.getCurrentPage(),c=e.getPage(h.getCurrentPage()).facs||"",d="data/images/";b.vm.content='<img src="'+d+c+'" alt="Image of page '+a+" of "+h.getCurrentDocument()+"\" onerror=\"this.setAttribute('src', 'images/empty-image.jpg')\"/>",b.vm.isLoading=!1};break;case"text":C.selectors.push({id:"document_"+A,type:"document",initValue:h.getCurrentDocument()},{id:"editionLevel_"+A,type:"edition",initValue:h.getCurrentEdition()}),C.buttons.push({title:"Witnesses List",label:"",icon:"witnesses",type:"witList"}),G=e.getCriticalEntriesFiltersCollection(),G.forLemmas>0&&(C.buttons.push({title:"Color key",label:"",icon:"color-legend",type:"colorLegend"}),D.buttons.push({title:"Filters",label:"Filters",icon:"filters",type:"toggleFilterApp",show:function(){return"critical"===g.edition}}),G=G.filters),F.filters={_totActive:0},F.filterBox=!1,F.docId=h.getCurrentDocument(),d.toolHeatMap&&D.buttons.push({title:"Heat Map",label:"Heat Map",icon:"heatmap",type:"heatmap",show:function(){return"text"===g.type&&"critical"===g.edition}}),D.buttons.push({title:"Change font size",label:"",icon:"font-size",type:"fontSizeTools",show:function(){return!0}}),z=function(){b.vm.isLoading=!0;var a='<span class="alert-msg alert-msg-error">There was an error in the parsing of the text. <br />Try a different browser or contact the developers.</span>',d='<span class="alert-msg alert-msg-error">Text is not available.</span>';if(void 0!==b.vm.edition&&"critical"===b.vm.edition){var g=e.getCriticalText(b.vm.state.docId);if(void 0===g){g=e.getDocument(b.vm.state.docId);try{var h=[];h.push(f.parseCriticalText(g.content,b.vm.state.docId).promise),c.all(h).then(function(){b.vm.content=e.getCriticalText(b.vm.state.docId)||d,b.vm.isLoading=!1})}catch(i){K=a,b.vm.isLoading=!1}}else b.vm.content=g||d,b.vm.isLoading=!1}else b.vm.content=d,b.vm.isLoading=!1};break;case"witness":var L=void 0!==g.witPage&&""!==g.witPage?g.witness+"-"+g.witPage:"";C.selectors.push({id:"witnesses_"+A,type:"witness",initValue:g.witness},{id:"page_"+A,type:"witness-page",initValue:L}),C.buttons.push({title:"Info",label:"",icon:"info",type:"toggleInfoWit"},{title:"Remove Witness",label:"",icon:"remove",type:"removeWit"}),G=e.getCriticalEntriesFiltersCollection(),G.forVariants>0&&(D.buttons.push({title:"Filters",label:"Filters",icon:"filters",type:"toggleFilterApp",show:function(){return"true"}}),G=G.filters),F.filters={_totActive:0},F.filterBox=!1,D.buttons.push({title:"Change font size",label:"",icon:"font-size",type:"fontSizeTools",show:function(){return!0}}),z=function(){b.vm.isLoading=!0;var a='<span class="alert-msg alert-msg-error">There was an error in the parsing of the text. <br />Try a different browser or contact the developers.</span>',d="Text of witness "+g.witness+" is not available.";if(void 0!==g.witness){var i=h.getCurrentDocument(),j=e.getWitnessText(g.witness,i)||void 0;if(void 0===j){var k=e.getDocuments(),l="";if(k.length>0&&(l=k[i]),void 0!==l)try{var m=[];m.push(f.parseWitnessText(l.content,i,g.witness).promise),c.all(m).then(function(){b.vm.content=e.getWitnessText(g.witness,i)||d,b.vm.isLoading=!1})}catch(n){b.vm.content=a,b.vm.isLoading=!1}else b.vm.content=d,b.vm.isLoading=!1}else b.vm.content=j,b.vm.isLoading=!1}};break;default:H=!1,C.buttons.push("pinnedBoard"===B?{title:"Close Board",label:"",icon:"remove",type:"closePinned"}:{title:"Remove Box",label:"",icon:"remove",type:"removeBox"}),z=function(a){b.vm.content=a}}return J={uid:A,defaults:angular.copy(a),topMenuList:C,bottomMenuList:D,content:v,topBoxContent:E,state:F,appFilters:G,isLoading:H,genericTools:I,updateContent:z,updateTopBoxContent:p,updateState:i,getState:j,destroy:k,toggleCriticalAppFilter:l,toggleFilterBox:o,toggleTopBox:n,clearFilter:m,fontSize:q,fontSizeIncrease:r,fontSizeDecrease:s,fontSizeReset:t,toggleBtnGroup:u},w[A]=angular.extend(g,J),x.push({id:A,type:B}),w[A]}},v.getById=function(a){return"undefined"!==w[a]?w[a]:void 0},v.getList=function(){return x},v.getListByType=function(a){var b=[];for(var c in w)w[c].type===a&&b.push(w[c]);return b},v.getElementByValueOfParameter=function(a,b){var c;for(var d in w)w[d][a]===b&&(c=w[d]);return c},v.alignScrollToApp=function(a){for(var b in w)void 0!==w[b].scrollToAppEntry&&w[b].scrollToAppEntry(a)},v}]}),angular.module("evtviewer.box").directive("box",["$timeout","evtBox","evtInterface","xmlParser","config",function(a,b,c,d,e){return{restrict:"E",scope:{id:"@",type:"@",subtype:"@",witness:"@",witpage:"@",edition:"@"},transclude:!0,templateUrl:"src/box/box.dir.tmpl.html",link:function(f,g){function h(a){var b;b=window.ActiveXObject?new ActiveXObject("Msxml2.XMLHTTP"):new XMLHttpRequest,b.open("GET",a,!1);try{b.responseType="msxml-document"}catch(c){}return b.send(""),b.responseXML}function i(a,b){if(""!==b){var c=d.parse(f.vm.content),e=h(b);if(window.ActiveXObject){var g=c.transformNode(e);f.vm.content=g}else if(document.implementation&&document.implementation.createDocument){var i=new XSLTProcessor;i.importStylesheet(e);var j=i.transformToFragment(c,document);f.vm.content=j}}}f.vm={id:f.id,type:f.type,subtype:f.subtype,witness:f.witness,witPage:f.witpage,edition:f.edition};var j=b.build(f,f.vm),k=angular.element(g).find(".box")[0],l=angular.element(g).find(".box-body")[0];if(a(function(){j.updateContent(),("witness"===j.type||"text"===j.type)&&angular.element(l).bind("DOMMouseScroll mousewheel",function(){for(var a=0,b=!1,d="",e=angular.element(g).find(".pb");a<e.length&&!b;){var h=k.scrollTop+42,i=h+angular.element(k).height();d=e[a].getAttribute("data-id");var l=$("span.pb[data-id='"+d+"']").offset().top;i>=l&&l>=h?b=!0:a++}b&&"witness"===j.type&&c.getCurrentWitnessPage(f.witness)!==d.split("-")[1]&&(c.updateWitnessesPage(f.witness,d.split("-")[1]),c.updateUrl())}),"witness"===j.type,i(f,e.xsltUrl)}),f.vm.getTotElementsOfType=function(a){return b.getListByType(a).length},"witness"===j.type||"text"===j.type){f.vm.scrollToPage=function(b){a(function(){var a=$("#"+j.uid).find("#pb_"+b),c=1*window.getComputedStyle(l,null).getPropertyValue("padding-top").replace("px","");a.length>0&&void 0!==a[0]&&(l.scrollTop=a[0].offsetTop-c)})},f.vm.scrollToAppEntry=function(b){a(function(){var a=$("#"+j.uid).find("[data-app-id='"+b+"']"),c=1*window.getComputedStyle(l,null).getPropertyValue("padding-top").replace("px","");a.length>0&&void 0!==a[0]&&(l.scrollTop=a[0].offsetTop-c)})};var m,n=c.getCurrentAppEntry();"witness"===j.type?m=f.vm.witness+"-"+c.getCurrentWitnessPage(f.vm.witness):"text"===j.type&&(m=c.getCurrentPage()),f.vm.scrollToPage(m),f.vm.scrollToAppEntry(n),f.$watch(function(){return c.getCurrentDocument()},function(a,b){b!==a&&f.vm.state.docId!==a&&(f.vm.state.docId=a,f.vm.isLoading=!0,j.updateContent())},!0),f.$watch(function(){return f.vm.state.filters._totActive},function(b,c){c!==b&&a(function(){var a=angular.element(g).find(".filters-in-box")[0],b=angular.element(a).height(),c=angular.element(g).find(".box-body > *:last-child")[0];angular.element(c).css("margin-bottom",b+20+"px")})},!0)}"text"===j.type&&f.$watch(function(){return c.getCurrentEdition()},function(a,b){b!==a&&f.vm.edition!==a&&(f.vm.edition=a,j.updateContent())},!0),"image"===j.type&&f.$watch(function(){return c.getCurrentPage()},function(a,b){b!==a&&f.vm.state.docId!==a&&(f.vm.state.pageId=a,j.updateContent())},!0),f.$on("$destroy",function(){j&&j.destroy()})}}}]),angular.module("evtviewer.select",[]),angular.module("evtviewer.select").constant("SELECTORDEFAULTS",{expanded:!1,elementWidth:150,containerMaxHeight:170}).config(["evtSelectProvider","configProvider","SELECTORDEFAULTS",function(a,b,c){var d=b.makeDefaults("select",c);a.setDefaults(d)}]),angular.module("evtviewer.select").provider("evtSelect",function(){var a=this.defaults;this.setDefaults=function(b){a=b},this.$get=["$log","parsedData","evtInterface",function(b,c,d){var e={},f={},g=[],h=0,i=b.getInstance("select");return e.build=function(b,e){var j,k,l,m,n,o=b.id||h++,p=b.type||"default",q=b.init||void 0,r=[],s={};if("undefined"==typeof f[o]){switch(p){case"page":l=function(a,b){i.log("page select callback ",b),void 0!==b&&(e.selectOption(b),d.updateCurrentPage(b.value),d.updateUrl())},m=function(a){for(var b=[],c=0;c<a.length;c++)b.push(a[a[c]]);return b},n=function(a){return a},r=m(c.getPages());break;case"document":l=function(a,b){void 0!==b&&(e.selectOption(b),d.updateCurrentDocument(b.value),d.updateUrl())},m=function(a){for(var b=[],c=0;c<a.length;c++)b.push(a[a[c]]);return b},n=function(a){return a},r=m(c.getDocuments());break;case"edition":l=function(a,b){void 0!==b&&(e.selectOption(b),d.updateCurrentEdition(b.value),d.updateUrl())},m=function(a){return a},n=function(a){return a},r=m(c.getEditions());break;case"witness":k=q,l=function(a,b){e.collapse(),void 0!==a?void 0!==b&&(d.switchWitnesses(a.value,b.value),d.updateUrl()):void 0!==b&&(d.addWitness(b.value),d.updateUrl())},m=function(a){for(var b=[],c=a._indexes.witnesses,d=0;d<c.length;d++){var e=a[c[d]],f={value:e.id,label:e.id,title:e.description};b.push(f)}return b},n=function(a){var b={};return b={value:a.id,label:a.id,title:a.description}},r=m(c.getWitnesses());break;case"witness-page":var t=b.$parent.vm.witness;
k=q,l=function(a,c){void 0!==c&&(e.selectOption(c),d.updateWitnessesPage(t,c.value.split("-")[1]),d.updateUrl(),b.$parent.vm.scrollToPage(c.value))},m=function(a){for(var b=[],c=0;c<a.length;c++)b.push(a[a[c]]);return b},n=function(a){return a},r=m(c.getWitnessPages(t))}return s={uid:o,defaults:angular.copy(a),callback:l,initValue:q,currentType:p,optionList:r,optionSelected:j,optionSelectedValue:k,formatOptionList:m,formatOption:n},f[o]=angular.extend(e,s),g.push({id:o,type:p}),f[o]}},e.getById=function(a){return void 0!==f[a]?f[a]:void 0},e.getList=function(){return g},e.expandById=function(a,b){"undefined"!==f[a]&&(f[a].expand(),b&&e.closeAll())},e.closeAll=function(a){angular.forEach(f,function(b,c){c!==a&&b.collapse()})},e.addOption=function(a,b){"undefined"!==f[a]&&f[a].optionList.push(b)},e.setCallback=function(a,b){"undefined"!==f[a]&&(f[a].callback=b)},e.destroy=function(a){delete f[a]},e}]}),angular.module("evtviewer.select").controller("SelectCtrl",["$log","evtSelect","parsedData",function(a,b,c){{var d=this;a.getInstance("select")}d.expand=function(){d.expanded=!0},d.collapse=function(){d.expanded=!1},d.toggleExpand=function(a){a||b.closeAll(d.uid),d.expanded=!d.expanded},d.getOptionSelected=function(){return d.optionSelected},d.selectOption=function(a){d.expanded&&d.toggleExpand(),d.optionSelected=a,d.optionSelectedValue=void 0!==a?a.value:void 0},d.selectOptionByValue=function(a){var b;if(void 0!==a&&""!==a)switch(d.currentType){case"page":b=d.formatOption(c.getPage(a));break;case"document":b=d.formatOption(c.getDocument(a));break;case"edition":b=d.formatOption(c.getEdition(a));break;case"witness":b=d.formatOption(c.getWitness(a));break;case"witness-page":b=d.formatOption(c.getPage(a));break;default:b=d.optionList[0]}else b=d.optionList[0];void 0!==b&&d.selectOption(b)},d.isOptionSelected=function(a){if(void 0!==a){if("undefined"==typeof d.optionSelected)return;return d.optionSelected.value===a.value}},d.destroy=function(){var a=d.uid;b.destroy(a)}}]),angular.module("evtviewer.select").directive("evtSelect",["$timeout","evtSelect","evtInterface",function(a,b,c){return{restrict:"E",scope:{id:"@",type:"@",init:"@"},templateUrl:"src/select/select.directive.tmpl.html",controllerAs:"vm",controller:"SelectCtrl",link:function(d){var e=b.build(d,d.vm);if(a(function(){void 0!==e&&(void 0!==d.init&&""!==d.init?e.selectOptionByValue(d.init):e.callback(void 0,d.vm.optionList[0]))}),"witness-page"===d.type){var f=d.$parent.vm.witness;d.$watch(function(){return c.getCurrentWitnessPage(f)},function(a,b){b!==a&&e.selectOptionByValue(f+"-"+a)},!0)}d.$on("$destroy",function(){e&&e.destroy()})}}}]),angular.module("evtviewer.buttonSwitch",[]),angular.module("evtviewer.buttonSwitch").provider("evtButtonSwitch",function(){var a=this.defaults;this.setDefaults=function(b){a=b},this.$get=["$timeout","$log","parsedData","evtInterface","evtDialog","evtSelect",function(b,c,d,e,f,g){var h={},i={},j=[],k=0,l=(c.getInstance("box"),function(a){var b="";switch(angular.lowercase(a)){case"add":b="icon-evt_add";break;case"color-legend":b="icon-evt_color-legend";break;case"filter":case"filters":b="icon-evt_filter";break;case"font-size":b="icon-evt_font-size";break;case"font-size-minus":b="icon-evt_font-size-minus-alt";break;case"font-size-plus":b="icon-evt_font-size-plus-alt";break;case"font-size-reset":b="icon-evt_font-size-reset-alt";break;case"heatmap":b="icon-evt_heatmap-alt";break;case"info":b="icon-evt_info";break;case"list":b="icon-evt_list";break;case"menu-vert":b="icon-evt_more-vert";break;case"mode-imgtxt":b="icon-evt_imgtxt";break;case"mode-txttxt":b="icon-evt_txttxt";break;case"mode-critical":b="icon-evt_txt";break;case"mode-collation":b="icon-evt_collation";break;case"mode-bookreader":b="icon-evt_bookreader";break;case"pin":b="icon-evt_pin-alt-on";break;case"pin-off":b="icon-evt_pin-off";break;case"pin-on":b="icon-evt_pin-on";break;case"remove":b="icon-evt_close";break;case"search":b="icon-evt_search";break;case"bookmark":b="icon-evt_bookmark";break;case"thumb":case"thumbs":case"thumbnail":case"thumbnails":b="icon-evt_thumb";break;case"v-align":b="icon-evt_align";break;case"witnesses":b="icon-evt_books"}return b}),m=function(){var a=this;a.active=!a.active},n=function(a){var b=this;b.active=a},o=function(){var a=this;a.disabled=!0},p=function(){var a=this;a.disabled=!1},q=function(){var a=this.uid;delete i[a]};return h.build=function(b){var c=b.id||k++,r=b.type||"default",s=b.title||"",t=b.label||"",u=l(b.icon)||"",v=b.type||"",w=b.value||"",x=b.active||!1,y=b.disabled||!1,z=b.btnType||"",A=function(){console.log("TODO "+v)},B=function(){},C={};switch(v){case"addWit":z="standAlone",A=function(){e.updateProperty("witnessSelector",!0),b.vm.active=!1};break;case"alignReadings":break;case"bookmark":A=function(){var a=this;e.updateSecondaryContentOpened("bookmark"),f.openByType("bookmark"),a.active=!a.active};break;case"changeViewMode":z="standAlone",A=function(){var a=this;void 0!==a.value&&(e.updateCurrentViewMode(a.value),"critical"===a.value&&e.updateCurrentEdition("critical"),e.updateUrl())};break;case"colorLegend":z="toggler",A=function(){var a=b.$parent.vm;if(a.getState("topBoxOpened")&&"colorLegend"===a.getState("topBoxContent"))a.toggleTopBox();else{var c=d.getCriticalEntriesFiltersCollection(),e="";if(c.length>0){e+='<div class="colorLegend">';for(var f in c.filters){var g=c.filters[f],h="";for(var i in g.values){var j=g.values[i].name,k='<i class="colorLegend-filter-color" style="background:'+g.values[i].color+'"></i>';h+='<span class="colorLegend-filter-value">'+k+j+"</span>"}""!==h&&(e+='<span class="colorLegend-filter-name">'+f+"</span>"+h)}e+="</div>"}else e="<span>No filters available</span>";var l=e||'<span class="errorMsg">There was an error</span>';a.updateTopBoxContent(l),a.updateState("topBoxContent","colorLegend"),a.getState("topBoxOpened")||a.toggleTopBox()}},B=function(){var a=b.$parent.vm;a.updateState("topBoxOpened",!1)};break;case"closeDialog":A=function(){var a=this;f.closeAll(),e.updateSecondaryContentOpened(""),a.active=!a.active};break;case"closePinned":A=function(){e.togglePinnedAppBoardOpened()};break;case"fontSizeDecrease":z="standAlone",A=function(){var a=this;b.$parent.vm.fontSizeDecrease(),a.active=!a.active};break;case"fontSizeIncrease":z="standAlone",A=function(){var a=this;b.$parent.vm.fontSizeIncrease(),a.active=!a.active};break;case"fontSizeReset":z="standAlone",A=function(){var a=this;b.$parent.vm.fontSizeReset(),a.active=!a.active};break;case"fontSizeTools":A=function(){var a=b.$parent.vm.getState("fontSizeBtn")||!1;b.$parent.vm.updateState("fontSizeBtn",!a)},B=function(){b.$parent.vm.updateState("fontSizeBtn",!1)};break;case"heatmap":z="standAlone",A=function(){var a=b.$parent.vm.getState("heatmap")||!1;b.$parent.vm.updateState("heatmap",!a)};break;case"openGlobalDialogInfo":A=function(){var a=this;e.updateSecondaryContentOpened("globalInfo"),f.openByType("globalInfo"),a.active=!a.active};break;case"openGlobalDialogWitnesses":A=function(){var a=this;e.updateSecondaryContentOpened("witnessesList"),f.openByType("witnessesList"),a.active=!a.active};break;case"pin":case"pin-on":case"pin-off":break;case"removeWit":A=function(){var a=b.$parent.vm.witness;e.removeWitness(a),e.updateUrl()};break;case"searchInEdition":A=function(){var a=b.$parent.vm.edition;alert("Search in edition level "+a+". Coming Soon...")};break;case"searchInWit":A=function(){var a=b.$parent.vm.witness;alert("Search in witness "+a+". Coming Soon...")};break;case"share":A=function(){alert(window.location)};break;case"toggleInfoWit":z="toggler",A=function(){var a=d.getWitness(b.$parent.vm.witness),c=a.description||b.$parent.vm.topBoxContent;b.$parent.vm.updateTopBoxContent(c),b.$parent.vm.toggleTopBox()},B=function(){b.$parent.vm.updateState("topBoxOpened",!1)};break;case"toggleFilterApp":A=function(){b.$parent.vm.toggleFilterBox()},B=A;break;case"togglePinned":z="toggler",A=function(){e.togglePinnedAppBoardOpened()};break;case"witList":z="toggler",A=function(){var a=b.$parent.vm;if(a.getState("topBoxOpened")&&"witList"===a.getState("topBoxContent"))a.toggleTopBox();else{var c=d.getWitnessesListFormatted(),e=c||'<span class="errorMsg">There was an error</span>';a.updateTopBoxContent(e),a.updateState("topBoxContent","witList"),a.getState("topBoxOpened")||a.toggleTopBox()}},B=function(){var a=b.$parent.vm;a.updateState("topBoxOpened",!1)}}var D=function(){var a=this;h.unselectAllSkipByBtnType(a.uid,"standAlone"),g.closeAll(),a.toggleActive(),a.callback()};return C={uid:c,defaults:angular.copy(a),currentId:c,currentType:r,title:s,label:t,icon:u,type:v,value:w,active:x,disabled:y,btnType:z,callback:A,doCallback:D,fakeCallback:B,toggleActive:m,setActive:n,disable:o,enable:p,destroy:q},i[c]=angular.extend(b.vm,C),j.push({id:c,type:r}),i[c]},h.getById=function(a){return"undefined"!==i[a]?i[a]:void 0},h.getList=function(){return j},h.unselectAll=function(){angular.forEach(i,function(a){a.setActive(!1)})},h.unselectAllSkipByBtnType=function(a,b){angular.forEach(i,function(c){c.uid!==a&&b.indexOf(c.btnType)<0&&(c.active&&c.fakeCallback(),c.setActive(!1))})},h.selectById=function(a){"undefined"!==i[a]&&i[a].setActive(!0)},h.destroy=function(a){delete i[a]},h}]}),angular.module("evtviewer.buttonSwitch").directive("buttonSwitch",["evtButtonSwitch","evtInterface",function(a,b){return{restrict:"E",scope:{title:"@",label:"@",icon:"@",type:"@",value:"@"},templateUrl:"src/buttonSwitch/buttonSwitch.dir.tmpl.html",link:function(c){c.vm={};var d=a.build(c);"addWit"===c.type&&(0===b.getAvailableWitnesses().length&&(c.vm.disabled=!0,c.vm.title="No more witnesses available"),c.$watch(function(){return b.getAvailableWitnesses()},function(a,b){a!==b&&(0===a.length?(c.vm.disabled=!0,c.vm.title="No more witnesses available"):(c.vm.disabled=!1,c.vm.title="Add witness"))},!0)),"changeViewMode"===c.type&&c.$watch(function(){return b.getCurrentViewMode()},function(a){c.vm.active=a===c.vm.value?!0:!1},!0),c.$on("$destroy",function(){d&&d.destroy()})}}}]),angular.module("evtviewer.popover",[]),angular.module("evtviewer.popover").constant("POPOVERDEFAULTS",{expanded:!1,tooltipOver:!1,tooltipMaxHeight:170,tooltipMaxWidth:200,openTriggerEvent:"click"}).config(["evtPopoverProvider","configProvider","POPOVERDEFAULTS",function(a,b,c){var d=b.makeDefaults("popover",c);a.setDefaults(d)}]),angular.module("evtviewer.popover").provider("evtPopover",function(){var a=this.defaults;this.setDefaults=function(b){a=b},this.$get=function(){var b={},c={},d=[],e=0;return b.build=function(b,f,g){var h=e++,i=b||"",j=f||"",k={};return"undefined"==typeof c[h]?(k={uid:h,trigger:i,tooltip:j,expanded:angular.copy(a.expanded),tooltipOver:angular.copy(a.tooltipOver),defaults:angular.copy(a)},c[h]=angular.extend(g,k),d.push({id:h}),c[h]):void 0},b.getById=function(a){return"undefined"!==c[a]?c[a]:void 0},b.getList=function(){return d},b.expandById=function(a,d){"undefined"!==c[a]&&(c[a].expand(),d&&b.closeAll(a))},b.closeAll=function(a){angular.forEach(c,function(b,c){void 0===a?b.collapse():c!==a.toString()&&b.collapse()})},b.mouseOutAll=function(a){angular.forEach(c,function(b,c){c!==a.toString()&&b.mouseOut()})},b.getIdTooltipOvered=function(){var a=-1;return angular.forEach(c,function(b){b.tooltipOver&&(a=b.uid)}),a},b.destroy=function(a){delete c[a]},b}}),angular.module("evtviewer.popover").controller("PopoverCtrl",["$log","$scope","evtPopover",function(a,b,c){var d=this;d.parentRef=".box-body";a.getInstance("popover");this.expand=function(){d.expanded=!0},this.collapse=function(){d.expanded=!1},this.mouseOver=function(){d.over=!0},this.mouseOut=function(){d.over=!1},this.tooltipMouseOver=function(){d.tooltipOver=!0},this.tooltipMouseOut=function(){d.tooltipOver=!1},this.toggleExpand=function(a){a||c.closeAll(d.uid),d.expanded=!d.expanded},this.toggleOver=function(a){a||c.mouseOutAll(d.uid),d.over=!d.over},this.toggleTooltipOver=function(){d.tooltipOver=!d.tooltipOver},this.destroy=function(){var a=d.uid;c.destroy(a)}}]),angular.module("evtviewer.popover").directive("evtPopover",["evtPopover",function(a){return{restrict:"E",scope:{trigger:"@",tooltip:"@"},transclude:!0,templateUrl:"src/popover/popover.directive.tmpl.html",controllerAs:"vm",controller:"PopoverCtrl",link:function(b,c){b.vm.toggleTooltipHover=function(a,b){a.stopPropagation(),b.toggleTooltipOver()},b.vm.toggleMouseHover=function(c,d){c.stopPropagation(),"over"!==d.trigger||d.over||d.expanded||b.vm.resizeTooltip(c,d.defaults);var e=a.getIdTooltipOvered();(0>e||e===d.uid)&&d.toggleOver()},b.vm.triggerClick=function(b,c){b.stopPropagation(),"over"===c.trigger||c.expanded||c.resizeTooltip(b,c.defaults);var d=a.getIdTooltipOvered();(0>d||d===c.uid)&&c.toggleExpand()},b.vm.resizeTooltip=function(a,d){a.stopPropagation();var e=b.vm.parentRef,f=c,g=angular.element(c).find("span.popover_tooltip").last(),h=angular.element(g).find(".popover__tooltip__before"),i=a.clientX,j=a.clientY;g.removeAttr("style");var k,l,m,n=f.height(),k=1*f.css("font-size").substr(0,2)+1,o=(f.width(),f.position().top),l=(f.position().left,g.offset().top,g.outerWidth()),m=g.outerHeight();l>d.tooltipMaxWidth&&g.css({width:d.tooltipMaxWidth+"px","max-width":d.tooltipMaxWidth+"px"}),g.css({position:"absolute"}),l=g.outerWidth(),m=g.outerHeight();var p,q=c.parents(e).offset().left,r=c.parents(e).innerWidth(),s=i-q-l/2;g.css({left:s+"px"}),s+l>r&&(p=s+l-r,s=s-p-20,g.css({left:s+"px"})),0>s&&(s=0,g.css({left:s+"px"}));var t,u,v=c.parents(e).outerHeight(),w=o+n+m;w>v?(t=m+n+10,n>k&&(u=j-f.offset().top,t=t-u+10),g.css({"margin-top":-t+"px"}).addClass("open-up"),h.css({top:g.outerHeight()+2+"px"})):(g.removeClass("open-up"),n>k?(u=j-f.offset().top,p=n-k-u,g.css({"margin-top":-p+"px"})):g.css({"margin-top":"5px"}));var x=i-s-q-20;h.css({left:x+"px"}),l=g.width(),l>d.tooltipMaxWidth&&g.css({width:d.tooltipMaxWidth+"px","max-width":d.tooltipMaxWidth+"px"})};var d=a.build(b.trigger,b.tooltip,b.vm);b.$on("$destroy",function(){d&&d.destroy()})}}}]),angular.module("evtviewer.mobile",["ngRoute","ngAnimate","ngTouch"]),angular.module("evtviewer.mobile").directive("mainMobile",function(){return{restrict:"E",scope:{id:"@"},templateUrl:"src/mobile/mobile.dir.tmpl.html"}}),angular.module("evtviewer.mobile").provider("mobile",function(){var a=this.defaults;this.setDefaults=function(b){a=b},this.$get=["$log",function(a){var b={},c=a.getInstance("mobile"),d={currentView:"image"},e={currentEditionDipl:"diplomatic"},f={currentEditionInt:"interpretative"};return b.getState=function(){return d},b.getStateEditionDipl=function(){return e},b.getStateEditionInt=function(){return f},b.getCurrentView=function(){return d.currentView},b.getCurrentEditionDipl=function(){return e.currentEditionDipl},b.getCurrentEditionInt=function(){return f.currentEditionInt},b.switchView=function(a){d.currentView=a,c.log("Switch of current view in: "+a)},b.switchEditionDipl=function(a){e.currentEditionDipl=a,c.log("Switch of current edition in: "+a)},b.switchEditionInt=function(a){f.currentEditionInt=a,c.log("Switch of current edition in: "+a)},b}]}),angular.module("evtviewer.mobile").controller("MobileMenuCtrl",["$scope","mobile",function(a,b){var c,d=!1,e=b.getCurrentView();a.currentButton="image",a.showItems=!1,a.menu=[{template:"info",description:"The Digital Vercelli Book"},{template:"search",icon:"fa fa-search"}],a.view=[{template:"image",icon1:"fa fa-picture-o"},{template:"text",icon1:"fa fa-align-left"},{template:"imageimage",icon1:"fa fa-file-image-o",icon2:"fa fa-file-image-o"},{template:"imagetext",icon1:"fa fa-file-image-o",icon2:"fa fa-file-text-o"},{template:"texttext",icon1:"fa fa-file-text-o",icon2:"fa fa-file-text-o"}],a.showView=function(a){e=a,b.switchView(a),console.log("Switch mode "+a)},a.showSection=function(a){d&&a===c?(b.switchView(e),d=!1):(b.switchView(a),c=a,d=!0),console.log("Switch section "+a)},a.buttonSection=function(b){a.currentButton=a.currentButton===b.template?!a.currentButton:b.template},a.buttonView=function(b){a.currentButton=b.template},a.isActiveButton=function(b){return b===a.currentButton},a.toggleView=function(){a.showItems=!a.showItems}}]),angular.module("evtviewer.mobile").directive("menuMobile",function(){return{restrict:"E",scope:{id:"@"},templateUrl:"src/mobile/mobileMenu.dir.tmpl.html",controller:"MobileMenuCtrl"}}),angular.module("evtviewer.mobile").controller("MobileInfoCtrl",["$scope","mobile",function(a,b){a.view=b.getState(),a.dvb=[{url:"http://vbd.humnet.unipi.it/",title:"Digital Vercelli Book project",description:"Digital Vercelli Book project"},{url:"http://sourceforge.net/projects/evt-project/",title:"Edition Visualization Technology on SourceForge",description:"Edition Visualization Technology"},{url:"https://visualizationtechnology.wordpress.com/",title:"EVT Blog",description:"EVT Blog"},{url:"mailto: editionvisualizationtechnology@gmail.com",title:"Contact",description:"Contact"}]}]),angular.module("evtviewer.mobile").directive("infoMobile",function(){return{restrict:"E",scope:{id:"@"},templateUrl:"src/mobile/mobileInfo.dir.tmpl.html",controller:"MobileInfoCtrl"}}),angular.module("evtviewer.mobile").controller("MobileSearchCtrl",["$scope","mobile","parsedData",function(a,b,c){a.view=b.getState(),a.mockSearchLetters=c.getSearchLetters(),a.mockSearchFilters=c.getSearchFilters(),a.mockText=c.getText1(),a.listResults=!0,a.Search=["Search..."],a.buttonsOption=[{description:"&#198;",tab:"tabLetters"},{icon:"fa fa-cogs",tab:"tabFilters"}],a.removeText=function(){a.Search=null},a.showTabOptions=function(b){a.currentOption=a.currentOption===b.tab?!a.currentOption:b.tab},a.isActiveTab=function(b){return b===a.currentOption},a.showResults=function(){a.listResults=!a.listResults}}]),angular.module("evtviewer.mobile").directive("searchMobile",function(){return{restrict:"E",scope:{id:"@"},templateUrl:"src/mobile/mobileSearch.dir.tmpl.html",controller:"MobileSearchCtrl"}}),angular.module("evtviewer.mobile").controller("MobileViewCtrl",["$scope","mobile","parsedData",function(a,b,c){a.view=b.getState(),a.mockText=c.getText2(),a.mockImage=c.getImage2(),a.mockBook=c.getBook2();var d=b.getCurrentEditionDipl(),e=b.getCurrentEditionInt();a.editionDipl=b.getStateEditionDipl(),a.editionInt=b.getStateEditionInt(),a.currentButtonDipl="diplomatic",a.currentButtonInt="interpretative",a.leftTextOptions=!1,a.rightTextOptions=!1,a.imageOptions=!1,a.navThumb=!1,a.thumbnails=c.getThumb2(),a.thumbBook=c.getThumbBook2(),a.currentIndex=0,a.isActive=function(b){return a.currentIndex===b},a.prevItem=function(){a.currentIndex=a.currentIndex>0?--a.currentIndex:a.mockImage.length-1},a.nextItem=function(){a.currentIndex=a.currentIndex<a.mockImage.length-1?++a.currentIndex:0},a.prevImageImage=function(){a.currentIndex=a.currentIndex>0?--a.currentIndex:a.mockBook.length-1},a.nextImageImage=function(){a.currentIndex=a.currentIndex<a.mockBook.length-1?++a.currentIndex:0},a.textEdition=[{template:"diplomatic",description:"Diplomatic"},{template:"interpretative",description:"Interpretative"}],a.showEditionDipl=function(a){d=a,b.switchEditionDipl(a),console.log("Switch edition "+a)},a.showEditionInt=function(a){e=a,b.switchEditionInt(a),console.log("Switch edition "+a)},a.buttonEditionDipl=function(b){a.currentButtonDipl=b.template},a.buttonEditionInt=function(b){a.currentButtonInt=b.template},a.isActiveButtonDipl=function(b){return b===a.currentButtonDipl},a.isActiveButtonInt=function(b){return b===a.currentButtonInt},a.leftTextSettings=function(){a.leftTextOptions=!a.leftTextOptions},a.rightTextSettings=function(){a.rightTextOptions=!a.rightTextOptions},a.showImageSettings=function(){a.imageOptions=!a.imageOptions},a.showThumb=function(){a.navThumb=!a.navThumb},a.showImage=function(b){a.currentIndex=b}}]),angular.module("evtviewer.mobile").directive("viewMobile",function(){return{restrict:"E",scope:{id:"@"},templateUrl:"src/mobile/mobileView.dir.tmpl.html",controller:"MobileViewCtrl"}}),angular.module("evtviewer.criticalApparatusEntry",[]),angular.module("evtviewer.criticalApparatusEntry").constant("APPENTRYDEFAULTS",{firstSubContentOpened:""}).config(["evtCriticalApparatusEntryProvider","configProvider","APPENTRYDEFAULTS",function(a,b,c){var d=b.makeDefaults("criticalApparatusEntry",c);a.setDefaults(d)}]),angular.module("evtviewer.criticalApparatusEntry").provider("evtCriticalApparatusEntry",function(){var a=this.defaults;this.setDefaults=function(b){a=b},this.$get=["parsedData","baseData","evtCriticalParser","evtCriticalApparatus",function(b,c,d,e){var f={},g={},h=[],i=0,j=[];return f.build=function(f,j){var k=i++,l=f||void 0,m=j.scopeWit||"",n=j.type||"default",o={};if("undefined"==typeof g[k]){var p,q="",r={_indexes:[]},s=b.getCriticalEntryById(f);if(void 0===s){var t=c.getXMLDocuments()[0];t=t.cloneNode(!0),d.findCriticalEntryById(t,f),s=b.getCriticalEntryById(f)}return void 0!==s&&(p=e.getContent(s,s._subApp,m),""!==p.criticalNote&&(r._indexes.push("criticalNote"),r.criticalNote={label:"Critical Note"}),p.notSignificantReadings.length>0&&(r._indexes.push("notSignificantReadings"),r.notSignificantReadings={label:"Orthographic Variants"}),r._indexes.push("moreInfo"),r.moreInfo={label:"More Info"},""!==s._xmlSource&&(r._indexes.push("xmlSource"),r.xmlSource={label:"XML"},p.xmlSource=s._xmlSource.replace(/ xmlns="http:\/\/www\.tei-c\.org\/ns\/1\.0"/g,"")),r._indexes.length>0&&""!==a.firstSubContentOpened&&(q=r._indexes.indexOf(a.firstSubContentOpened)<0?r._indexes[0]:a.firstSubContentOpened)),o={uid:k,scopeWit:m,appId:l,readingId:j.readingId,content:p,type:n,_subContentOpened:q,over:!1,tabs:r},g[k]=angular.extend(j.vm,o),h.push({id:k}),g[k]}},f.getById=function(a){return"undefined"!==g[a]?g[a]:void 0},f.getList=function(){return h},f.destroy=function(a){delete g[a]},f.getPinned=function(){return j},f.setPinned=function(a){j=a},f.isPinned=function(a){return j.indexOf(a)>=0},f.pin=function(a){j.indexOf(a)<0&&j.push(a)},f.unpin=function(a){var b=j.indexOf(a);b>=0&&j.splice(b,1)},f}]}),angular.module("evtviewer.criticalApparatusEntry").controller("CriticalApparatusEntryCtrl",["$log","$scope","config","evtCriticalApparatusEntry","evtReading","evtBox",function(a,b,c,d,e,f){b.content={};var g=this;this.toggleSubContent=function(a){g._subContentOpened=g._subContentOpened!==a?a:""},this.toggleOverAppEntries=function(a){a.stopPropagation(),void 0===g.readingId&&(g.over===!1?e.mouseOverByAppId(g.appId):e.mouseOutAll())},this.isPinAvailable=function(){return c.toolPinAppEntries},this.isPinned=function(){return d.isPinned(g.appId)},this.getPinnedState=function(){return g.isPinned()?"pin-on":"pin-off"},this.togglePin=function(){g.isPinned()?(console.log("unpin"),d.unpin(g.appId)):d.pin(g.appId),document.cookie="pinned="+d.getPinned()+"; 1"},this.alignReadings=function(){f.alignScrollToApp(g.appId)},this.destroy=function(){var a=this.uid;d.destroy(a)}}]),angular.module("evtviewer.criticalApparatusEntry").directive("evtCriticalApparatusEntry",["evtCriticalApparatusEntry","parsedData","evtInterface",function(a,b,c){return{restrict:"E",scope:{appId:"@",readingId:"@",scopeWit:"@",type:"@",visible:"@"},transclude:!0,templateUrl:"src/criticalApparatusEntry/criticalApparatusEntry.directive.tmpl.html",controllerAs:"vm",controller:"CriticalApparatusEntryCtrl",link:function(b){b.scopeViewMode=c.getCurrentViewMode();var d=a.build(b.appId,b);b.$on("$destroy",function(){d&&d.destroy()})}}}]),angular.module("evtviewer.criticalApparatusEntry").directive("evtWitnessRef",["evtCriticalApparatusEntry","evtBox","parsedData","evtInterface",function(a,b,c,d){return{restrict:"E",require:"^evtCriticalApparatusEntry",scope:{witness:"@",scopeWit:"@"},transclude:!0,templateUrl:"src/criticalApparatusEntry/criticalApparatusEntry.witnessRef.directive.tmpl.html",link:function(a){a.title=a.scopeWit===a.witness?a.witness+" is the current witness":"Open witness "+a.witness+" next to this box",a.openWit=function(){var c=a.witness,e=a.scopeWit;if(c!==e){var f=d.getCurrentWitnesses(),g=f.indexOf(e);f.indexOf(c)>=0&&d.removeWitness(c),void 0!==g&&d.addWitnessAtIndex(c,g+1),"collation"!==d.getCurrentView&&d.updateCurrentViewMode("collation"),d.updateUrl();var h=d.getCurrentAppEntry()||"";if(""!==h){var i=b.getElementByValueOfParameter("witness",c);void 0!==i&&i.scrollToAppEntry(h)}}}}}}]),angular.module("evtviewer.reading",[]),angular.module("evtviewer.reading").constant("READINGDEFAULTS",{tooltipMaxHeight:170,tooltipMaxWidth:200,openTriggerEvent:"click"}).config(["evtReadingProvider","configProvider","READINGDEFAULTS",function(a,b,c){var d=b.makeDefaults("popover",c);a.setDefaults(d)}]),angular.module("evtviewer.reading").provider("evtReading",function(){var a=this.defaults;this.setDefaults=function(b){a=b};var b="";this.$get=["parsedData",function(c){var d={},e={},f=[],g=0;return d.build=function(b,h){var i,j=g++,k=b||void 0,l="",m={};if("undefined"==typeof e[j]){if(void 0!==h.readingId){var n=c.getReadingAttributes(h.readingId,b)||[];for(var o in n)"wit"!==o&&"xml:id"!==o&&(l+=o.toUpperCase()+": "+n[o]+" - ");""!==l&&(l=l.slice(0,-3))}var p=c.getCriticalEntryById(k);return p._subApp&&(i=p._indexes._parentEntry||""),m={uid:j,scopeWit:h.scopeWit||"",appId:k,parentAppId:i,readingId:h.readingId,readingType:h.readingType,variance:h.variance,type:h.type,attributes:l,over:!1,apparatus:{opened:!1,content:{},_loaded:!1,_subContentOpened:"criticalNote"},selected:k===d.getCurrentAppEntry(),openTriggerEvent:angular.copy(a.openTriggerEvent),defaults:angular.copy(a)},e[j]=angular.extend(h.vm,m),f.push({id:j}),e[j]}},d.getById=function(a){return"undefined"!==e[a]?e[a]:void 0},d.getList=function(){return f},d.setCurrentAppEntry=function(a){b=a},d.getCurrentAppEntry=function(){return b},d.mouseOutAll=function(){angular.forEach(e,function(a){a.mouseOut()})},d.mouseOverByAppId=function(a){angular.forEach(e,function(b){b.appId===a?b.mouseOver():b.mouseOut()})},d.unselectAll=function(){angular.forEach(e,function(a){a.unselect()})},d.closeAllApparatus=function(a){angular.forEach(e,function(b){void 0===a?b.closeApparatus():b.uid!==a&&b.closeApparatus()})},d.selectById=function(a){angular.forEach(e,function(b){b.appId===a?b.setSelected():b.unselect()}),d.setCurrentAppEntry(a)},d.destroy=function(a){delete e[a]},d}]}),angular.module("evtviewer.reading").controller("ReadingCtrl",["config","$log","$scope","evtReading","parsedData","evtPopover","evtCriticalParser","baseData","evtInterface","config",function(a,b,c,d,e,f,g,h,i,a){{var j=this;b.getInstance("reading")}this.mouseOver=function(){j.over=!0},this.mouseOut=function(){j.over=!1},this.setSelected=function(){j.selected=!0},this.unselect=function(){j.selected=!1},this.isSelect=function(){return void 0!==j.parentAppId?j.selected||i.getCurrentAppEntry()===j.parentAppId:j.selected},this.isApparatusOpened=function(){return j.apparatus.opened&&!c.$parent.vm.state.topBoxOpened},this.closeApparatus=function(){j.apparatus.opened=!1},this.openApparatus=function(){j.apparatus.opened=!0},this.toggleTooltipOver=function(){j.tooltipOver=!j.tooltipOver},this.toggleOverAppEntries=function(a){a.stopPropagation(),j.hidden||(j.over===!1?d.mouseOverByAppId(j.appId):d.mouseOutAll())},this.toggleSelectAppEntries=function(){j.hidden||(j.selected===!1?j.apparatus.opened||(d.selectById(j.appId),i.updateCurrentAppEntry(j.appId)):j.apparatus.opened&&(d.unselectAll(),i.updateCurrentAppEntry(""))),i.updateUrl()},this.toggleApparatus=function(){f.closeAll(),!j.hidden&&j.over&&(j.apparatus._loaded||(j.apparatus._loaded=!0),d.closeAllApparatus(j.uid),j.apparatus.opened=!j.apparatus.opened)},this.callbackClick=function(a){a.stopPropagation(),j.over&&(j.toggleSelectAppEntries(a),j.isSelect()&&j.apparatus.opened||j.toggleApparatus(a))},this.isApparatusOpened=function(){return j.apparatus.opened},this.openApparatusSubContent=function(a){j.apparatus._subContentOpened=a},this.backgroundColor=function(){return"variant"===j.type?l():k()};var k=function(){var b;if(c.$parent.vm.state.heatmap){var d=e.getCriticalEntriesMaxVariance();b=j.over&&!c.$parent.vm.state.topBoxOpened?"1":j.variance/d;var f=a.heatmapColor.replace("rgb","rgba").slice(0,-1)+","+b+")";return"background: "+f}return l()},l=function(){var b,d,f,g,h,i,k=a.possibleVariantFilters,l=a.possibleLemmaFilters;if(void 0!==j.appId&&(g=e.getCriticalEntryById(j.appId),h=void 0!==j.readingId?g.content[j.readingId]:g.content[g.lemma],void 0!==h&&(i=h.attributes||{},d=e.getCriticalEntriesFilters(),f="witness"===c.$parent.vm.type?k:l,Object.keys(i).length>0))){var m="",n=!j.over&&!j.isSelect()||c.$parent.vm.state.topBoxOpened?".4":"1";for(var o in d){var p=d[o].name;if(f.indexOf(p)>=0&&void 0!==i&&void 0!==i[p])for(var q in d[o].values){var r=d[o].values[q].color,s=d[o].values[q].name;if(i[p]===s){var t=r.replace("rgb","rgba");m+=t.slice(0,-1)+","+n+"),"}}}""!==m&&(m=m.slice(0,-1),m.match(/rgb/gi)&&m.match(/rgb/gi).length>1||m.match(/#/gi)&&m.match(/#/gi).length>1?(b="background: -moz-linear-gradient(left,"+m+");",b+="background: -webkit-linear-gradient(left,"+m+");",b+="background: ms-linear-gradient(left,"+m+");",b+="background: linear-gradient(left,"+m+");"):b="background: "+m)}return void 0===b&&(c.$parent.vm.state.topBoxOpened||(b=j.over||j.isSelect()?"background: "+a.variantColorDark:"background: "+a.variantColorLight)),b};this.fitFilters=function(){var a,b,d,f,g,h,i,k,l,m=e.getCriticalEntryById(j.appId),n="OR",o=!1,p=0;if(void 0!==m&&(a=void 0!==j.readingId?m.content[j.readingId]:m.content[m.lemma],void 0!==a)){b=a.attributes||{};var q=c.$parent.vm.state.filters||{},r=Object.keys(q);if("OR"===n){d=!1;for(l in r){if(g=r[l],f=q[g],f.totActive>0&&(p++,void 0!==b&&void 0!==b[g]))for(h=0,i=f.values;h<i.length&&!d;)k=i[i[h]].name,d=d||b[g]===k,h++;if(d)break}o=d}else{var s=!0;for(l in r)if(g=r[l],f=q[g],f.totActive>0){if(p++,d=!1,void 0!==b&&void 0!==b[g])for(i=f.values,h=0;h<i.length;h++)k=i[i[h]].name,d=d||b[g]===k;s=s&&d}o=s}}return 0===p&&(o=!0),j.hidden=!o,o},this.destroy=function(){var a=this.uid;d.destroy(a)}}]),angular.module("evtviewer.reading").directive("evtReading",["evtReading","parsedData",function(a){return{restrict:"E",scope:{appId:"@",readingId:"@",readingType:"@",variance:"@",scopeWit:"@",type:"@"},transclude:!0,templateUrl:"src/reading/reading.directive.tmpl.html",controllerAs:"vm",controller:"ReadingCtrl",link:function(b){var c=a.build(b.appId,b);b.$on("$destroy",function(){c&&c.destroy()})}}}]),angular.module("evtviewer.dialog",[]),angular.module("evtviewer.dialog").constant("DIALOGDEFAULTS",{}).config(["evtDialogProvider","configProvider","DIALOGDEFAULTS",function(a,b,c){var d=b.makeDefaults("dialog",c);a.setDefaults(d)}]),angular.module("evtviewer.dialog").provider("evtDialog",function(){var a=this.defaults;this.setDefaults=function(b){a=b},this.$get=["$log",function(b){function c(){var a=this;a.opened=!0}function d(){var a=this;a.opened=!1}function e(a){var b=this;b.title=a}function f(a){var b=this;b.content=a}function g(){var a=this.uid;delete i[a]}{var h={},i={},j=[],k=0;b.getInstance("dialog")}return h.build=function(b){var h,l=b.id||k++,m=b.type||"default",n=b.title||"",o=!1,p={};return"undefined"==typeof i[l]?(p={uid:l,defaults:angular.copy(a),type:m,content:h,title:n,opened:o,open:c,close:d,setTitle:e,updateContent:f,destroy:g},i[l]=angular.extend(b.vm,p),j.push({id:l,type:m}),i[l]):void 0},h.getById=function(a){return"undefined"!==i[a]?i[a]:void 0},h.getList=function(){return j},h.getListByType=function(a){var b=[];for(var c in i)i[c].type===a&&b.push(i[c]);return b},h.openByType=function(a){for(var b in i)i[b].type===a&&i[b].open()},h.closeAll=function(){for(var a in i)void 0!==i[a].close()&&i[a].close()},h}]}),angular.module("evtviewer.dialog").directive("evtDialog",["evtDialog",function(a){return{restrict:"E",scope:{id:"@",type:"@",title:"@"},replace:!0,transclude:!0,templateUrl:"src/dialog/dialog.dir.tmpl.html",link:function(b){b.vm={id:b.id,type:b.type,title:b.title};var c=a.build(b);b.$on("$destroy",function(){c&&c.destroy()})}}}]),angular.module("evtviewer.tabsContainer",[]),angular.module("evtviewer.tabsContainer").controller("TabsContainerCtrl",["$log","$scope","parsedData",function(a,b,c){if(b.subContentOpened="",b.tabs={_indexes:[]},b.toggleSubContent=function(a){b.subContentOpened=b.subContentOpened!==a?a:""
},"projectInfo"===b.type){var d="<span>No content</span>",e=c.getProjectInfo().fileDescription||"";""!==e&&(b.tabs.fileDescription={label:"File Description",name:"fileDescription",content:e||d},b.tabs._indexes.push("fileDescription"));var f=c.getProjectInfo().encodingDescription||"";""!==f&&(b.tabs.encodingDescription={label:"Encoding Description",name:"encodingDescription",content:f||d},b.tabs._indexes.push("encodingDescription"));var g=c.getProjectInfo().textProfile||"";""!==g&&(b.tabs.textProfile={label:"Text Profile",name:"textProfile",content:g||d},b.tabs._indexes.push("textProfile"));var h=c.getProjectInfo().outsideMetadata||"";""!==h&&(b.tabs.outsideMetadata={label:"Outside Metadata",name:"outsideMetadata",content:h||d},b.tabs._indexes.push("outsideMetadata"));var i=c.getProjectInfo().revisionHistory||"";""!==i&&(b.tabs.revisionHistory={label:"Revision History",name:"revisionHistory",content:i||d},b.tabs._indexes.push("revisionHistory"))}b.subContentOpened=b.tabs._indexes[0]||"";var j=a.getInstance("tabsContainer");j.log("TabsContainerCtrl running")}]),angular.module("evtviewer.tabsContainer").directive("evtTabsContainer",function(){return{restrict:"E",scope:{type:"@",orientation:"@"},templateUrl:"src/tabsContainer/tabsContainer.dir.tmpl.html",controller:"TabsContainerCtrl"}});